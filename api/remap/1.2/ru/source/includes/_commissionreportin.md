<!-- include(metadata.apib) -->

# Полученный отчёт комиссионера
Средствами JSON API можно создавать и обновлять сведения о полученных отчётах комиссионера, запрашивать списки полученных отчётов комиссионера и сведения по отдельным полученным отчётам комиссионера. Позициями отчётов комиссионера можно управлять как в составе отдельного отчёта, так и с помощью специальных ресурсов для управления позициями. Кодом сущности для полученного отчёта комиссионера в составе JSON API является ключевое слово **commissionreportin**. Больше об отчётах комиссионера и работе с ними в основном интерфейсе вы можете прочитать в нашей службе поддержки по  [этой ссылке](https://support.moysklad.ru/hc/ru/articles/203082686-%D0%9A%D0%BE%D0%BC%D0%B8%D1%81%D1%81%D0%B8%D0%BE%D0%BD%D0%BD%D0%B0%D1%8F-%D1%82%D0%BE%D1%80%D0%B3%D0%BE%D0%B2%D0%BB%D1%8F-%D0%9A%D0%BE%D0%BC%D0%B8%D1%82%D0%B5%D0%BD%D1%82%D1%83).

## Полученные отчёты комиссионера [/entity/commissionreportin]
### Атрибуты сущности
+ **meta** - [Метаданные](/api/remap/1.2/doc/index.html#header-метаданные) о полученном отчёте комиссионера
+ **id** - ID в формате UUID `Только для чтения`
+ **accountId** - ID учетной записи `Только для чтения`
+ **syncId** - ID синхронизации. После заполнения недоступен для изменения.
+ **updated** - Момент последнего обновления сущности `Только для чтения`
+ **deleted** - Момент последнего удаления сущности `Только для чтения`
+ **name** - номер полученного отчёта комиссионера `Необходимое`
+ **description** - Комментарий полученного отчёта комиссионера
+ **externalCode** - Внешний код полученного отчёта комиссионера
+ **moment** - Дата полученного отчёта комиссионера
+ **applicable** - Отметка о проведении
+ **sum** - Сумма полученного отчёта комиссионера в копейках `Только для чтения`
+ **rate** - Валюта
+ **owner** - Ссылка на Владельца (Сотрудника) в формате [Метаданных](/api/remap/1.2/doc/index.html#header-метаданные)
+ **shared** - Общий доступ
+ **group** - Отдел сотрудника в формате [Метаданных](/api/remap/1.2/doc/index.html#header-метаданные)
+ **organization** - Ссылка на ваше юрлицо в формате [Метаданных](/api/remap/1.2/doc/index.html#header-метаданные) `Необходимое`
+ **agent** - Ссылка на контрагента в формате [Метаданных](/api/remap/1.2/doc/index.html#header-метаданные) `Необходимое`
+ **contract** - Ссылка на договор в формате [Метаданных](/api/remap/1.2/doc/index.html#header-метаданные) `Необходимое`
+ **project** - Ссылка на проект в формате [Метаданных](/api/remap/1.2/doc/index.html#header-метаданные)
+ **state** - Статус полученного отчёта комиссионера в формате [Метаданных](/api/remap/1.2/doc/index.html#header-метаданные)
+ **organizationAccount** - Ссылка на счёт вашего юрлица в формате [Метаданных](/api/remap/1.2/doc/index.html#header-метаданные)
+ **agentAccount** - Ссылка на счёт контрагента в формате [Метаданных](/api/remap/1.2/doc/index.html#header-метаданные)
+ **attributes** - Коллекция доп. полей в формате [Метаданных](/api/remap/1.2/doc/index.html#header-метаданные)
<br>Поля при expand'е:</br>
  - **name** - номер документа
  - **moment** - дата печати
  - **href** - ссылка на файл печатной формы
  - **fileName** - название файла печатной формы
  - **updated** - дата последнего изменения
+ **created** - Дата создания `Только для чтения`
+ **vatSum** - Сумма НДС `Только для чтения`
+ **payedSum** - Оплаченная сумма `Только для чтения`
+ **vatEnabled** - Учитывается ли НДС
+ **vatIncluded** - Включен ли НДС в цену
+ **positions** - Ссылка на позиции полученного отчёта комиссионера в формате [Метаданных](/api/remap/1.2/doc/index.html#header-метаданные)
+ **commissionPeriodStart** - Начало периода `Необходимое`
+ **commissionPeriodEnd** - Конец периода `Необходимое`
+ **rewardType** - Тип вознаграждения
+ **rewardPercent** - Процент вознаграждения (всегда 0 если вознаграждение не рассчитывается)
+ **commitentSum** - Сумма коммитента в установленной валюте `Только для чтения`
### Связи с другими документами
+ **payments** - Массив ссылок на связанные платежи в формате [Метаданных](/api/remap/1.2/doc/index.html#header-метаданные)


### Позиции полученного отчёта комиссионера
Позиции полученного отчёта комиссионера - это список товаров/услуг/модификаций/серий.
Объект позиции полученного отчёта комиссионера содержит следующие поля:
+ **id** - ID товара в формате UUID `Только для чтения`
+ **accountId** - ID учетной записи `Только для чтения`
+ **quantity** - Количество товаров/услуг данного вида в позиции. Если позиция - товар, у которого включен учёт по серийным номерам, то значение в этом поле всегда будет равно количеству серийных номеров для данной позиции в документе.
+ **price** - Цена товара/услуги в копейках
+ **vat** - НДС, которым облагается текущая позиция
+ **assortment** - Ссылка на товар/услугу/серию/модификацию, которую представляет собой позиция, в формате [Метаданных](/api/remap/1.2/doc/index.html#header-метаданные)
+ **pack** - Упаковка товара
+ **reward** - Вознаграждение

С позициями можно работать с помощью [специальных ресурсов для управления позициями полученного отчёта комиссионера](#полученный-отчёт-комиссионера-позиции-отчёта-комиссионера),
а также в составе отдельного полученного отчёта комиссионера. При работе в составе отдельного полученного отчёта комиссионера,
вы можете отправлять запросы на создание полученного отчёта комиссионера с включенным в тело запроса
массивом позиций полученного отчёта комиссионера. Если количество позиций превышает максимально допустимое, то для
дальнейшего пополнения позиций нужно будет работать со специальным ресурсом "Позиции отчёта комиссионера".
Также, при работе в составе отдельного полученного отчёта комиссионера, можно отправлять запросы на обновление списка позиций
с включенным в тело запроса массивом позиций полученного отчёта комиссионера. При этом важно помнить, что коллекция позиций будет
восприниматься как "все позиции полученного отчёта комиссионера" и полностью заменит уже существующую коллекцию при обновлении объекта - лишние
позиции будут удалены, новые добавлены, существующие - изменены.

<!-- include(rate.apib) -->


### Получить отчёты комиссионера[GET]
Запрос всех полученных отчётов комиссионера на учётной записи.
+ Parameters
  + limit: 1000 (optional, enum[number])
  Максимальное количество сущностей для извлечения.
  <p>
    <code>Допустимые значения 1 - 1000</code>
  </p>
      + Default: `1000`
  + offset: 40 (optional, number)
    Отступ в выдаваемом списке сущностей
      + Default: `0`

  + search: `0001` (optional, string)
    URL Параметр для поиска по имени документа.
    Фильтр документов по указанной поисковой строке. Фильтрация происходит по
    полю name.

  + incomingDate: `2016-04-15 15:48:46` (optional, string)
    Параметр для фильтрации выборки по входящей дате. Подробнее про данный параметр можно посмотреть в разделе [Фильтрация выборки с помощью параметра filter](/api/remap/1.2/doc/index.html#header-фильтрация-выборки-с-помощью-параметра-filter).
    Формат строки : `ГГГГ-ММ-ДД ЧЧ:ММ:СС[.ммм]`, Часовой пояс: `MSK` (Московское время)

+ Response 200 (application/json)
Успешный запрос. Результат - JSON представление списка полученных отчётов комиссионера.
  + Body
        <!-- include(body/commissionreportin/get_list.json) -->

### Создать полученный отчёт комиссионера [POST]
Запрос на создание нового полученного отчёта комиссионера.
Обязательные для создания поля:
+ **name** - номер
+ **agent** - контрагент
+ **contract** - договор
+ **organization** - юрлицо
+ **commissionPeriodStart** - начало периода
+ **commissionPeriodEnd** - конец периода
+ **organizationAccount** - счёт юрлица (если у юрлица несколько счетов)
+ **agentAccount** - счёт контрагента (если у контрагента несколько счетов)

При указании поля **contract** важно:
+ Чтобы договор был заключён с указанным в поле **agent** контрагентом
+ Договор имел тип "Договор комиссии"

+ Request Пример (application/json)
Пример создания нового полученного отчёта комиссионера.
  + Body
        <!-- include(body/commissionreportin/post_request.json) -->

+ Response 200 (application/json)
Успешный запрос. Результат - JSON представление созданного полученного отчёта комиссионера.
  + Body
        <!-- include(body/commissionreportin/post_response.json) -->

### Массовое создание и обновление полученных отчётов комиссионера [POST]
[Массовое создание и обновление](/api/remap/1.2/doc/index.html#header-создание-и-обновление-нескольких-объектов) полученных отчётов комиссионера.
В теле запроса нужно передать массив, содержащий JSON представления полученных отчётов комиссионера, которые вы хотите создать или обновить.
Обновляемые полученные отчёты комиссионера должны содержать идентификатор в виде метаданных.

+ Request Пример (application/json)
Пример создания и обновления нескольких полученных отчётов комиссионера
  + Body
        <!-- include(body/commissionreportin/post_massive_request.json) -->

+ Response 200 (application/json)
Успешный запрос. Результат - массив JSON представлений созданных и обновленных полученных отчётов комиссионера.
  + Body
        <!-- include(body/commissionreportin/post_massive_response.json) -->

### Удалить полученный отчёт комиссионера [DELETE /entity/commissionreportin/{id}]
+ Parameters
  + id: `7944ef04-f831-11e5-7a69-971500188b19` (required, string) - id полученного отчёта комиссионера

Запрос на удаление полученного отчёта комиссионера с указанным id.

+ Response 200 (application/json)
Успешное удаление полученного отчёта комиссионера.


## Метаданные полученного отчёта [/entity/commissionreportin/metadata]
### Метаданные полученного отчёта [GET]
Запрос на получение метаданных отчётов комиссионера. Результат - объект JSON, включающий в себя:
+ **meta** - Ссылка на метаданные отчётов комиссионера
+ **attributes** - Массив объектов доп. полей отчётов комиссионера в формате [Метаданных](/api/remap/1.2/doc/index.html#header-метаданные)
+ **states** - Массив статусов отчётов комиссионера
+ **createShared** - создавать новые отчёты комиссионера с меткой "Общий"

Структура отдельного объекта, представляющего доп. поле подробно описана в разделе [Работа с дополнительными полями](/api/remap/1.2/doc/index.html#header-работа-с-дополнительными-полями).

+ Response 200 (application/json)
Успешный запрос. Результат - JSON представление метаданных полученного отчёта комиссионера.
  + Body
        <!-- include(body/commissionreportin/get_metadata.json) -->

## Отдельное доп. поле [/entity/commissionreportin/metadata/attributes/{id}]
+ Parameters
  + id: `7944ef04-f831-11e5-7a69-971500188b19` (required, string) - id Доп. поля
### Отдельное доп. поле [GET]
Запрос на получение информации по отдельному дополнительному полю.
+ Response 200 (application/json)
Успешный запрос. Результат - JSON представление отдельного доп. поля.
  + Body
        <!-- include(body/commissionreportin/metadata_by_id.json) -->

## Полученный отчёт комиссионера [/entity/commissionreportin/{id}]
+ Parameters
  + id: `7944ef04-f831-11e5-7a69-971500188b19` (required, string) - id полученного отчёта комиссионера

### Получить отчёт комиссионера [GET]
Запрос на получение отдельного отчёта комиссионера с указанным id.
+ Response 200 (application/json)
Успешный запрос. Результат - JSON представление полученного отчёта комиссионера.
  + Body
        <!-- include(body/commissionreportin/get_by_id.json) -->

### Изменить полученный отчёт комиссионера [PUT]
Запрос на обновление полученного отчёта комиссионера с указанным id.
В теле запроса можно указать только те поля, которые необходимо изменить у полученного отчёта комиссионера, кроме тех, что
помечены `Только для чтения` в описании [атрибутов полученного отчёта комиссионера](#полученный-отчёт-комиссионера-полученные-отчёты-комиссионера).
При обновлении полей **organization** и **agent** нужно также обновить поля **organizationAccount** и
**agentAccount** соответственно, иначе произойдёт ошибка.

<br>При указании поля **contract** важно:
+ Чтобы договор был заключён с указанным в поле **agent** контрагентом
+ Договор имел тип "Договор комиссии"

+ Request Пример (application/json)
Пример запроса на обновление отдельного отчёта комиссионера.
  + Body
        <!-- include(body/commissionreportin/put_request.json) -->

+ Response 200 (application/json)
Успешный запрос. Результат - JSON представление обновлённого отчёта комиссионера.
  + Body
        <!-- include(body/commissionreportin/put_response.json) -->

## Позиции отчёта комиссионера [/entity/commissionreportin/{id}/positions]
Отдельный ресурс для управления позициями полученного отчёта комиссионера. С его помощью вы можете управлять позициями большого документа, количество строк в котором превышает лимит на количество строк, сохраняемых вместе с документом. Этот лимит равен 100. Более подробно о лимитах на количество строк документа и работе с большими документами можно прочитать [тут](/api/remap/1.2/doc/index.html#header-работа-с-позициями-документов).
+ Parameters
  + id: `7944ef04-f831-11e5-7a69-971500188b19` (required, string) - id полученного отчёта комиссионера

### Получить позиции [GET]
Запрос на получение списка всех позиций данного полученного отчёта комиссионера.

+ Parameters
  + limit: 1000 (optional, enum[number])
  Максимальное количество сущностей для извлечения.
  <p>
    <code>Допустимые значения 1 - 1000</code>
  </p>
      + Default: `1000`
  + offset: 40 (optional, number)
    Отступ в выдаваемом списке сущностей
      + Default: `0`

+ Response 200 (application/json)
Успешный запрос. Результат - JSON представление списка позиций отдельного отчёта комиссионера.
  + Body
        <!-- include(body/commissionreportin/positions_get_list.json) -->

### Создать позицию [POST]
Запрос на создание новой позиции в отчёте комиссионера.
Для успешного создания необходимо в теле запроса указать следующие поля:
+ **assortment** - Ссылка на товар/услугу/серию/модификацию, которую представляет собой позиция.
Также можно указать поле с именем **service**, **consignment**, **variant** в соответствии с тем,
чем является указанная позиция. Подробнее об этом поле можно прочитать в описании [позиции отчёта комиссионера](#header-позиции-полученного-отчёта-комиссионера)
+ **quantity** - Количество указанной позиции. Должно быть положительным, иначе возникнет ошибка.
Одновременно можно создать как одну так и несколько позиций отчёта комиссионера. Все созданные данным запросом позиции
будут добавлены к уже существующим.

+ Request Пример (application/json)
Пример создания одной позиции в полученном отчёте комиссионера.
  + Body
        <!-- include(body/commissionreportin/positions_post_request.json) -->
+ Response 200 (application/json)
Успешный запрос. Результат - JSON представление созданной позиции отдельного отчёта комиссионера.
  + Body
        <!-- include(body/commissionreportin/positions_post_response.json) -->

### Удалить позицию [DELETE /entity/commissionreportin/{id}/positions/{positionID}]
+ Parameters
  + id: `7944ef04-f831-11e5-7a69-971500188b19` (required, string) - id полученного отчёта комиссионера
  + positionID: `7944ef04-f831-11e5-7a69-971500188b19` (required, string) - id позиции полученного отчёта комиссионера

Запрос на удаление позиции полученного отчёта комиссионера с указанным id.

+ Response 200 (application/json)
Успешное удаление позиции полученного отчёта комиссионера.

## Позиция отчёта комиссионера [/entity/commissionreportin/{id}/positions/{positionID}]
+ Parameters
  + id: `7944ef04-f831-11e5-7a69-971500188b19` (required, string) - id полученного отчёта комиссионера
  + positionID: `34f6344f-015e-11e6-9464-e4de0000006c` (required, string) - id позиции полученного отчёта комиссионера

### Получить позицию [GET]
Запрос на получение отдельной позиции полученного отчёта комиссионера с указанным id.
+ Response 200 (application/json)
Успешный запрос. Результат - JSON представление отдельной позиции полученного отчёта комиссионера.
  + Body
        <!-- include(body/commissionreportin/positions_get_by_id.json) -->

### Изменить позицию [PUT]
Запрос на обновление отдельной позиции полученного отчёта комиссионера. Для обновления позиции нет каких-либо
 обязательных для указания в теле запроса полей. Только те, что вы желаете обновить.

+ Request Пример (application/json)
Пример запроса на обновление отдельной позиции в полученном отчёте комиссионера.
  + Body
        <!-- include(body/commissionreportin/positions_put_request.json) -->

+ Response 200 (application/json)
Успешный запрос. Результат - JSON представление обновлённой позиции полученного отчёта комиссионера.
  + Body
        <!-- include(body/commissionreportin/positions_put_response.json) -->
