
# Общие Сведения

## Аутентификация
Для того чтобы успешно взаимодействовать с JSON API онлайн-сервиса МойСклад необходимо аутентифицироваться в системе. МойСклад поддерживает аутентификацию по протоколу Basic Auth, при которой вместе с запросом передаётся заголовок `Authorization` со значением пары `логин:пароль`, зашифрованной в вариантом RFC2045-MIME кодировки Base64. Аутентификация по протоколу Basic Auth с автоматической генерацией соответствующего заголовка поддерживается во многих
HTTP-клиентах, таких как Postman, curl и т.п.

## Ограничения
Для JSON API установлены следующие ограничения:

  + Не более 100 запросов за 5 секундный период
  + Не более 5 параллельных запросов от одного пользователя
  + Не более 20 параллельных запросов от аккаунта
  + Не более 500 запросов с одного ip-адреса
  + Не более 10 Мб данных в одном запросе, отправляемом на сервер

Также накладывается ограничение на максимальное число объектов (позиций, материалов, продуктов), передаваемых в одном массиве в запросе - не более 100 элементов.
В случае, если количество элементов коллекции превышает максимально допустимое, произойдёт ошибка со статусом 413.
Если количество позиций превышает максимально допустимое, то для дальнейшего пополнения позиций нужно будет работать со специальным ресурсом,
описание которого приведено в конкретной сущности.

## Метаданные
В JSON есть несколько видов Метаданных. Один из них - поле **meta**, которое фигурирует в большинстве
JSON представлений объектов, и содержит информацию об объекте или о выдаче, а также может использоваться в качестве ссылки
на другой объект. Поле **meta** представляет собой объект со следующими атрибутами:

+ **href** - Ссылка на объект
+ **metadataHref** - Ссылка на метаданные сущности (Другой вид метаданных. Присутствует не во всех сущностях)
+ **type** - Тип объекта
+ **mediaType** - Тип данных, которые приходят в ответ от сервиса, либо отправляются
в теле запроса. В рамках данного  API всегда равен `application/json`
+ **uuidHref** -  Ссылка на объект на UI. Присутствует не во всех сущностях. Может быть использована для получения uuid

### Атрибуты расширенного объекта meta

Следующие атрибуты объекта **meta** появляются, как правило, в методах выдачи списка сущностей/строк отчёта.
В них содержится информация о выдаче, пришедшей в ответ. В объектах **meta**, содержащих
данные лишь об одном объекте (например поле **meta** в объекте **context**) нижеперечисленные атрибуты не фигурируют.

+ **size** - Размер выданного списка
+ **limit** - Максимальное количество элементов в выданном списке. Максимальное количество элементов в списке равно 1000, для вложенных коллекций - 100.
+ **offset** - Отступ в выданном списке

### Метаданные сущности
Другой вид Метаданных. Представляет собой отдельный ресурс, содержащий информацию обо всех объектах сущностей данного типа.
**Есть не у каждой сущности.** Присутствует лишь у тех сущностей, у которых в данной документации описан ресурс "Метаданные <наименование_сущности>".
Как правило содержит информацию о вложенных сущностях, коллекциях и дополнительных полях.

JSON API позволяет получить метаданные всех сущностей с помощью метода `/entity/metadata`. Также можно ограничить
выборку, указав в фильтре **type** только необходимые сущности.

```shell
curl -X GET 
  "https://online.moysklad.ru/api/remap/1.2/entity/metadata?filter=type=product;type=service;type=demand"
  -H "Authorization: Basic <api token>"
```

> Пример тела запроса:

```json
{
  "service": {
    "meta": {
      "href": "https://online.moysklad.ru/api/remap/1.2/entity/service/metadata",
      "mediaType": "application/json"
    }
  },
  "product": {
    "meta": {
      "href": "https://online.moysklad.ru/api/remap/1.2/entity/product/metadata",
      "mediaType": "application/json"
    }
  },
  "demand": {
    "meta": {
      "href": "https://online.moysklad.ru/api/remap/1.2/entity/demand/metadata",
      "mediaType": "application/json"
    }
  }
}
```

### Мета коллекций 
**meta** коллекций содержит все те же атрибуты, что и **meta** сущностей, однако, если в списке появляется больше
позиций, чем умещается на одной странице (size > limit) в объект **meta** добавляются след. поля:

+ **nextHref** - Ссылка на предыдущую страницу сущностей.
+ **previousHref** - Ссылка на следующую страницу сущностей.

**meta** с такими полями можно встретить при выполнении запросов на получение всех объектов определённого типа
 на учетной записи (например запрос всех отгрузок), а также при запросе всех позиций отдельного документа.

## Обработка ошибок
### СТРУКТУРА ОШИБОК
Ошибка в данном API представляет собой массив **errors**, содержащий объекты **error**, каждый из которых описывает отдельную ошибку.
### СТРУКТУРА ОБЪЕКТА error
+ **error** - Заголовок ошибки
+ **parameter** - Параметр, на котором произошла ошибка
+ **code** - Код ошибки (Если поле ничего не содержит, смотрите HTTP status code)
+ **error_message**  - Сообщение, прилагаемое к ошибке.

### Возвращаемые HTTP статусы ошибок и их значения:
| HTTP status code | Значение                                                                                                                                           |
| :--------------: |:---------------------------------------------------------------------------------------------------------------------------------------------------|
| 301              | Запрашиваемый ресурс находится по другому URL.                                                                                                     |
| 303              | Запрашиваемый ресурс может быть найден по другому URI и должен быть найден с использоваием GET запроса                                             |
| 400              | Ошибка в структуре JSON передаваемого запроса                                                                                                      |
| 401              | Имя и/или пароль пользователя указаны неверно или заблокированы пользователь или аккаунт                                                           |
| 403              | У вас нет прав на просмотр данного объекта                                                                                                         |
| 404              | Запрошенный ресурс не существует                                                                                                                   |
| 405              | http-метод указан неверно для запрошенного ресурса                                                                                                 |
| 409              | Указанный объект используется и не может быть удалён                                                                                               |
| 410              | Версия API больше не поддерживается                                                                                                                |
| 412              | Не указан обязательный параметр строки запроса или поле структуры JSON                                                                             |
| 413              | Размер запроса или количество элементов запроса превышает лимит (например, количество позиций, передаваемых в массиве **positions**, превышает 100)|
| 429              | Превышен лимит количества запросов                                                                                                                 |
| 500              | При обработке запроса возникла непредвиденная ошибка                                                                                               |
| 502              | Сервис временно недоступен                                                                                                                         |
| 503              | Сервис временно отключен                                                                                                                           |
| 504              | Превышен таймаут обращения к сервису, повторите попытку позднее                                                                                    |

Также, вместе с телом ответа ошибки, вам могут прийти следующие заголовки (Headers):
+ X-Lognex-Auth - расширенный код ошибки аутентификации
+ X-Lognex-Auth-Message - сообщение об ошибке.
+ X-Lognex-API-Version-Deprecated - дата отключения запрошенной версии API.
+ Location - URL по которому доступен запрашиваемый ресурс (в случае ответа с кодом 301 или кодом 303)

Вы можете узнать лимит оставшихся запросов с помощью следующих заголовков
+ X-RateLimit-Limit - количество запросов, которые равномерно можно сделать в течение интервала до появления 429 ошибки
+ X-Lognex-Retry-TimeInterval - интервал в миллисекундах, в течение которого можно сделать эти запросы
+ X-RateLimit-Remaining - Число запросов, которые можно отправить до получения 429 ошибки
+ X-Lognex-Reset - время до сброса ограничения в миллисекундах. Равно нулю, если ограничение не установлено
+ X-Lognex-Retry-After - время до сброса ограничения в миллисекундах.


## Работа с дополнительными полями
Список сущностей, у которых есть доп. поля:

+ [Договор](/api/remap/1.2/doc/contract.html)
+ [Контрагент](/api/remap/1.2/doc/counterparty.html)
+ [Юрлицо](/api/remap/1.2/doc/organization.html)
+ [Проект](/api/remap/1.2/doc/project.html)
+ [Склад](/api/remap/1.2/doc/store.html)
+ [Сотрудник](/api/remap/1.2/doc/employee.html)
+ [Товар](/api/remap/1.2/doc/product.html)
+ [Услуга](/api/remap/1.2/doc/service.html)
+ [Комплект](/api/remap/1.2/doc/bundle.html)
+ [Серия](/api/remap/1.2/doc/consignment.html)
+ Все документы:
  - [Возврат покупателя](/api/remap/1.2/doc/sales_return.html)
  - [Возврат поставщику](/api/remap/1.2/doc/purchase_return.html)
  - [Входящий платёж](/api/remap/1.2/doc/payment_in.html)
  - [Заказ покупателя](/api/remap/1.2/doc/customerOrder.html)
  - [Заказ поставщику](/api/remap/1.2/doc/purchaseOrder.html)
  - [Исходящий платёж](/api/remap/1.2/doc/payment_out.html)
  - [Оприходование](/api/remap/1.2/doc/enter.html)
  - [Отгрузка](/api/remap/1.2/doc/demand.html)
  - [Перемещение](/api/remap/1.2/doc/move.html)
  - [Приёмка](/api/remap/1.2/doc/supply.html)
  - [Приходный ордер](/api/remap/1.2/doc/cashin.html)
  - [Расходный ордер](/api/remap/1.2/doc/cashout.html)
  - [Розничная продажа](/api/remap/1.2/doc/retaildemand.html)
  - [Розничная смена](/api/remap/1.2/doc/retailshift.html)
  - [Розничный возврат](/api/remap/1.2/doc/retail_sales_return.html)
  - [Списание](/api/remap/1.2/doc/loss.html)
  - [Инвентаризация](/api/remap/1.2/doc/inventory.html)
  - [Счёт покупателю](/api/remap/1.2/doc/invoice_out.html)
  - [Счёт поставщика](/api/remap/1.2/doc/invoice_in.html)
  - [Счёт-фактура выданный](/api/remap/1.2/doc/factureout.html)
  - [Счёт-фактура полученный](/api/remap/1.2/doc/facturein.html)
  - [Прайс-лист](/api/remap/1.2/doc/pricelist.html)
  - [Внутренний заказ](/api/remap/1.2/doc/internalOrder.html)
  - [Заказ на производство](/api/remap/1.2/doc/processingorder.html)
  - [Тех. операция](/api/remap/1.2/doc/processing.html)
  - [Полученный отчёт комиссионера](/api/remap/1.2/doc/commissionreportin.html)
  - [Выданный отчёт комиссионера](/api/remap/1.2/doc/commissionreportout.html)


Дополнительные поля сущности - внутренняя коллекция **attributes**.
Представлена в виде массива объектов с полями:

+ **meta** - Ссылка на метаданные доп. поля.
+ **id** - Id соответствующего доп. поля.
+ **name** - Наименование доп. поля
+ **value** - Значение, указанное в доп. поле.

Посмотреть все созданные в основном интерфейсе доп. поля можно с помощью запроса на получение метаданных Сущности.
Ответ - объект, содержащий метаданные об объектах данного типа, и в случае объектов, для которых определены доп. поля -
информацию о доп. полях в виде коллекции attributes, объекты которой содержат следующие поля:

+ **meta** - Ссылка на метаданные доп. поля
+ **id** - Id доп. поля
+ **name** - Наименование доп. поля
+ **type** - Тип доп. поля
+ **required** - Флажок о том, является ли доп. поле обязательным



Возможные значения типа доп. поля (поле **type**) и соответствующие им значения типа в JSON, а также
типы атрибута **value** в JSON объекта доп поля при соответствующем type:

| Тип атрибута        | Значение поля type в JSON        | Тип поля value в JSON |
| ------------------- |:---------------------------------| --------------------- |
| Строка              | string                           | string                |
| Число целое         | long                             | number                |
| Дата                | time                             | string                |
| Справочник          | {entityType}                     | object **             |
| Файл                | file                             | string                |
| Число дробное       | double                           | number                |
| Флажок              | boolean                          | boolean               |
| Текст               | text                             | string                |
| Ссылка              | link                             | string                |

Отдельного упоминания заслуживает тип Атрибута Справочник. Значение **type** в представлении
объекта атрибута будет разным, в зависимости от того, справочник каких сущностей был
выбран при создании Атрибута. Ниже представлена таблица, в которой при выбранном типе Атрибута
"Справочник" показаны значения поля type в зависимости от выбранного типа сущностей в справочнике.

Если в качестве типа доп. поля выбран пользовательский справочник, то в составе объекта данного
доп. поля появится новый атрибут **customEntityMeta** являющийся ссылкой на метаданные этого справочника.
Полный набор атрибутов доп. поля будет выглядеть следующим образом:

+ **meta** - Ссылка на метаданные доп. поля
+ **customEntityMeta** - Ссылка на метаданные пользовательского справочника
+ **id** - ID доп. поля
+ **name** - Наименование доп. поля
+ **type** - Тип доп. поля
+ **required** - Флажок о том, является ли доп. поле обязательным

| Тип сущностей справочника | Значение поля type в JSON (entityType) |
| ------------------------- |:---------------------------------------|
| [Контрагент]              | counterparty                           |
| [Товар]                   | product                                |
| [Склад]                   | store                                  |
| [Проект]                  | project                                |
| [Договор]                 | contract                               |
| [Сотрудник]               | employee                               |
| Имя_пользовательского справочника| customentity                    |

При выбранном типе Атрибута "Справочник" атрибут **value** в его представлении
будет объектом со следующими свойствами:
+ meta - [Метаданные](/api/remap/1.2/doc/index.html#header-метаданные), представляющие собой ссылку на сущность из соответствующего справочника
+ name - Наименование соответствующей сущности

Обнуление доп. поля типа "Справочник" происходит так же, как и при работе с другими доп. полям.
В запросе на обновление в коллекции attributes следует указать объект с id данного поля, а в качестве value передать null.

С коллекцией доп. полей можно работать только в контексте отдельной сущности. Доп. поля и их значения
можно передать как коллекцию структур {**id** : uuid, **value** : ""} в теле запроса  как на создание, так и на обновление сущности.
Опционально можно передать также значение полей **meta** и **name**.
В переданном массиве объектов можно указать не все доп. поля - проинициализируются/обновятся только указанные.
Если для доп. поля указан **id**, которого нет в метаданных сущности, то возникнет ошибка.

При обновлении значений доп.полей если в теле запроса на обновление сущности в массиве доп. полей:

+ Не указаны **id** каких-либо доп.полей, которым в данной сущности уже присвоено значение - соответствующие доп. поля обновлены не будут.
+ Указаны **id**, доп. полей, которым в данной сущности уже присвоено значение - соответствующим доп. полям будет присвоено переданное значение.
+ Указаны **id**, доп. полей, которым в данной сущности ещё не присвоено значение - соответствующим доп. полям эти новые значения будут присвоены.

В рамках JSON API нельзя создавать дополнительные поля.

### Доп. поля типа файл

Для загрузки значения для доп. поля типа файл нужно в JSON при создании или обновлении для значения поля указать объект следующей структуры:

+ **filename** - Имя файла `Необходимое`
+ **content** - Байты файла, закодированные в base64 `Необходимое`

Пример указания значения для доп. поля типа файл есть в секции [создания товара](/api/remap/1.2/doc/product.html#товар-товары-post)

## Работа с позициями документов
API сервиса МойСклад позволяет оперировать с такими документами как [Отгрузка](/api/remap/1.2/doc/demand.html), [Заказ покупателя](/api/remap/1.2/doc/customerOrder.html), [Счёт покупателю](/api/remap/1.2/doc/invoice_out.html),
[Розничная продажа](/api/remap/1.2/doc/retaildemand.html). Перечисленные документы содержат позиции, работать с которыми можно как в составе отдельного документа,
так и с помощью специальных ресурсов для управления позициями документа.
###  Работа с позициями в рамках отдельного документа 
При работе с позициями в рамках отдельного документа, их можно передавать как поле **positions**, представляющее собой массив позиций документа, в составе объекта, использующегося
в запросе на изменение или создание документа. В таком случае, массив позиций воспринимается как множество всех позиций документа
и полностью заменяет (в случае запроса на обновление) все уже существующие позиции в документе. В случае запроса на обновление, все позиции, которые существовали ранее в документе,
но не были переданы в теле запроса на обновление, будут удалены, все существующие позиции, id которых совпал с id передаваемых позиций в теле запроса, будут обновлены,
а новые позиции, которых ранее не было среди существующих позиций документа, будут добавлены в список позиций.
###  Работа с позициями документов с помощью специальных ресурсов 

> Пример тела запроса:

```json
[
  {
    "meta": {
        "href": "https://online.moysklad.ru/api/remap/1.2/entity/demand/405f69c0-019e-11e6-9464-e4de00000085/positions/727cf336-0310-11e6-9464-e4de00000013",
        "type": "demandposition",
        "mediaType": "application/json"
    }
  },
  {
    "meta": {
        "href": "https://online.moysklad.ru/api/remap/1.2/entity/demand/405f69c0-019e-11e6-9464-e4de00000085/positions/727cfce0-0310-11e6-9464-e4de00000014",
        "type": "demandposition",
        "mediaType": "application/json"
    }
  },
  {
    "meta": {
        "href": "https://online.moysklad.ru/api/remap/1.2/entity/demand/405f69c0-019e-11e6-9464-e4de00000085/positions/727d057f-0310-11e6-9464-e4de00000015",
        "type": "demandposition",
        "mediaType": "application/json"
    }
  }
]
```

В JSON API предусмотрены специальные ресурсы для управления позициями документов. Эти ресурсы как правило доступны по следующему URI и с помощью них вы сможете удалять позиции из документа, сделав запрос с методом DELETE по URL соответствующего ресурса с указание id позиции:
+ `/{код сущности документа, в составе JSON API}/{id отдельного документа}/positions`

Пример URL для запроса на удаление с помощью DELETE:
+ `/{код сущности документа, в составе JSON API}/{id отдельного документа}/positions/179dd832-960c-11e6-8a84-bae5000000dc`

При работе со специальными ресурсами можно запрашивать список всех позиций документа, создавать новые позиции, а также обновлять существующие.
При создании новых позиций с помощью данных ресурсов, можно обходить ограничение в 100 позиций на документ.
Также, используя данный ресурс, можно управлять массовым обновлением позиций. Для изменения сведений по отдельным позициям
необходимо использовать ресурсы управления отдельными позициями документа, которые доступны по URI:
+ `/{код сущности документа, в составе JSON API}/{id отдельного документа}/positions/{id отдельной позиции}`

Оба способа работы с позициями также описаны в документации по каждому из документов.

Также возможно массовое удаление позиций документа, используя метод POST по URL соответствующего ресурса. В теле запроса необходимо указать массив удаляемых позиций, указав поле **meta** у каждой из позиций.

Пример URL для запроса на массовое удаление позиций с помощью POST:
+ `/{код сущности документа, в составе JSON API}/{id отдельного документа}/positions/delete`


## Остатки в позициях документов

> Представление остатков в составе позиции

```json
"stock": {
    "cost": 5000,
    "quantity": 999,
    "reserve": 90,
    "intransit": 9,
    "available": 918
}
```

При запросе и обновлении документов есть возможность получать остатки позиций этих документов.
Для получения остатков в позициях документа в запросе нужно передать дополнительный параметр `fields=stock`.
Например,
+ `/customerorder/{id документа}?fields=stock&expand=positions`

Остатки можно получить по следующим документам: `[Отгрузка, Заказ Покупателя, Розничная продажа, Счет покупателя, Заказ поставщика, Счет поставщика, Приемка, Возврат поставщику, Возврат покупателя, Розничный возврат]`

Остатки для документов **Отгрузка**, **Розничная продажа**, **Приемка**, **Возврат поставщику**, **Возврат покупателя**, **Розничный возврат** расчитываются на момент поля **moment** в данных документах.
Для **Заказа покупателя**, **Счета покупателя**, **Заказа поставщика**, **Счета поставщика** остатки рассчитываются на текущий момент времени.

Получить остатки можно для следующих запросов:

+ Получения списка операций
+ Получение отдельной операции
+ Получение позиций операции
+ Получение отдельной позиции операции
+ Обновление операции
+ Обновление позиции

Для возврата покупателя без основания и розничного возврата без основания поле `cost` будет отсутствовать в составе `stock`.


## Назначение поля syncId
Сущностям, у которых среди атрибутов присутствует поле **syncId**, оно необходимо для того, чтобы в случае сбоя
при повторной отправке запроса на создание новой сущности не происходило дублирование объектов. Если в теле запроса
на создание сущности указать сгенерированный на клиенте syncId, то при повторной отправке этого же запроса (с тем же syncId) вместо создания
сущности с идентичными полями в ответ придёт ранее созданная сущность.
Сущности, поддерживающие поле **syncId**, можно удалить, используя url типа `/entity/{type}/syncid/{id}`.

## Создание и обновление объекта
При создании объекта достаточно заполнить только поля, помеченные `Необходимое`. Данные поля используются только при создании, при обновлении они не требуются.
Поля, помеченные `Только для чтения`, игнорируются при создании/обновлении объекта.

## Создание и обновление нескольких объектов
При использовании метода POST вы можете указать в теле запроса вместо одной -
массив сущностей. Для этого, вам нужно передать массив (начать тело запроса с `[` и закончить `]`), который будет содержать JSON представления
объектов, которые вы хотите создать или обновить. Обновляемые сущности должны содержать идентификатор в виде метаданных.
Если при обновлении сущность не найдена, она будет создана.
Лимит на создание и обновление объектов списком - 100

## Поддержка null
В рамках JSON API можно удалить значение из поля типа объект (если это поле не является обязательным, или же если данное поле в
основном интерфейсе может содержать пустое значение). Например: поле Договор(**contract**) в любом из документов. Сделать это можно передав в
запросе на обновление сущносте в данное поле null. Например: `{  "contract": null  }`.
Удаление валюты из документов (`{rate: null}`) равносильно изменению валюты документа на валюту по умолчанию. В результате все
цены и суммы будут пересчитаны. Накладные расходы также будут пересчитаны, если они не были указаны явно.

## Пустые поля
Если какое-то из полей сущности не было заполнено и, при этом оно не является обязательным, оно не будет выдано в JSON представлении этой сущности.

## Формат даты и времени
В JSON API поля типа дата-время (момент времени) - это строка в формате:
+ Без миллисекунд: `ГГГГ-ММ-ДД ЧЧ:мм:сс`
+ С миллисекундами: `ГГГГ-ММ-ДД ЧЧ:мм:сс.ммм`
Для получения полей типа дата-время с миллисекундами в формате: `ГГГГ-ММ-ДД ЧЧ:ММ:СС.ммм` нужно добавить специальный заголовок к запросу:<br>
`X-Lognex-Format-Millisecond` со значением `true`.
В запросах на создание/обновление сущностей, а также в параметрах фильтрации нужно указывать `moment` именно в этом формате.

Следующие поля устанавливаются и выводятся в JSON API с точностью до минут, а именно со значением секунд и миллисекунд равным `00`:

+ **incomingDate**
+ **commisionPeriodStart**
+ **commisionPeriodEnd**
+ **certificateDate**
+ **moment**
+ **deliveryPlannedMoment**
+ **paymentPlannedMoment**
+ **firstDemandDate**
+ **lastDemandDate**
+ дополнительное поле с типом **Дата**

## Сортировка объектов

Для сортировки списка объектов можно использовать url параметр `order`.
Значение этого параметра - **urlencoded** строка с условиями сортировки, перечисленными через `;`. (Все примеры ниже указаны без urlencoded для лучшей читаемости)
Каждое условие сортировки- это сочетание названия поля, запятой (опционально, если указывается направление сортировки), направления сортировки (опционально; может принимать значения  `asc` и `desc`. Значение по умолчанию - `asc`).

Сортировка поддерживается для следующих типов полей: числовой, строковый, дата-время, логический и uuid.

Примеры запросов с сортировкой:

+ https://online.moysklad.ru/api/remap/1.2/entity/supply?order=name
+ https://online.moysklad.ru/api/remap/1.2/entity/product?order=code,desc
+ https://online.moysklad.ru/api/remap/1.2/entity/product?order=name;code,desc
+ https://online.moysklad.ru/api/remap/1.2/entity/product?order=name,desc;code,asc

## Фильтрация выборки с помощью параметра filter
Для фильтрации выборки по нескольким полям можно использовать url параметр `filter`.
Значение этого параметра - **urlencoded** строка с поисковыми условиями, перечисленными через `;`. (Все примеры ниже указаны без urlencoded для лучшей читаемости)
Каждое поисковое условие - это сочетание названия поля, оператора и константы.
Фильтровать можно по всем полям, значения которых являются примитивными типами. Т.е. нельзя фильтровать поля-объекты и поля-массивы,
все остальные поля могут быть использованы в параметре `filter`.

+ Допустимые операторы: `['=', '>', '<', '>=', '<=', '!=', '~', '~=', '=~']`

Если в поисковом запросе несколько раз встречается условие типа "равенство" `=` применённое к одному и тому же полю,
то такое условие интерпретируется как совокупность условий, разделённых логическим оператором `ИЛИ`.
+ Например условие `filter=sum=100;sum=150` будет интерпретировано как `sum=100 ИЛИ sum=150`
или же `sum in (100, 150)`

Если же встречается несколько условий вида "не равно" `!=`, наложенных на одну и ту же переменную, то они интерпретируются как совокупность
условий разделённых логическим оператором `И`.
+ Например условие `filter=name!=0001;name!=0002` будет эквивалентно следующим (взаимно эквивалентным) условиям :
`name != 0001 И name != 0002` или `name not in (0001, 0002)`

Если на одно из полей наложено ограничение типа "равенство", а затем на него накладывается ограничение типа неравенство - в таком случае произойдёт ошибка.
+ Например условие `filter=sum=100;sum>99` вызовет ошибку.

Допускается использование одновременно нескольких одинаковых операторов сравнения `['>', '<', '>=', '<=']` для одного поля. При этом будет использовано лишь первое значение.
+ Например условие `filter=sum>99;sum>100` будет аналогично условию `filter=sum>99`.
В будущих версиях такое условие будет вызывать ошибку.

Фильтры, применённые к разным полям объединяются через логическое `И`, т.е. в запросе вида:
+ `filter=sum=100;moment>2016-10-11 12:00:00` выборка будет отфильтрована и по сумме и по дате.

###  Проверка на пустое значение 
Если в строке фильтрации указать конструкцию вида: `<имя_поля>=;` то в выборку попадут только объекты, где
данное поле равно null (т.е. отсутствует значение), а если тип поля - строковое, то будет также выполнена проверка на пустую строку, т.е. поле=''.
Конструкция `<имя_поля>!=;` выполнит проверку на присутствие значения. С помощью данной конструкции можно проверить наличие значения в ссылочном поле.

### Фильтрация документов
Для фильтрации выборки **документов** следует использовать параметр **isDeleted**. Может принимать значения `true` и `false`.
+ При указании значения `true` вернутся все документы данного типа, находящиеся в корзине.
+ При указании значения `false` вернутся только неудалённые документы.
+ Можно вывести все документы: и удалённые, и нет, указав в запросе оба значения данного параметра: `filter=isDeleted=true;isDeleted=false`.

### Фильтрация ссылочных полей
С помощью filter можно фильтровать ссылочные поля. Если в сущности присутствует ссылочное поле в виде метаданных,
можно использовать следующую конструкцию для того чтобы отфильтровать по этому полю выборку:
+ `filter=<имя_поля>=<ссылка>`

Пример ссылки:
+ `http://online.moysklad.ru/api/remap/1.2/entity/<type>/<id>`

Вот несколько примеров:
+ `filter=agent=http://online.moysklad.ru/api/remap/1.2/entity/counterparty/<id>`
+ `filter=ownAgent=http://online.moysklad.ru/api/remap/1.2/entity/organization/<id>`

Ссылочные поля, доступные для фильтрации:
+ agent
+ ownAgent
+ owner
+ group
+ parent
+ contract
+ project
+ organization
+ store
+ agentStore
+ supplier

Для розничных операций ("Розничная смена", "Розничная продажа", "Розничный возврат", "Внесение денег", "Выплата денег") также доступна фильтрация по:
+ retailstore

Примеры запросов для фильтрации :
+ `https://online.moysklad.ru/api/remap/1.2/entity/demand?filter=moment>2016-10-11 12:00:00;moment<2016-10-11 13:00:00;sum=100;name=0010;name=0011`
+ `https://online.moysklad.ru/api/remap/1.2/entity/counterparty?filter=name=Иван;phone=89269269222;email=vanyan@mail.krut`

### Фильтрация по полям типа ID
С помощью filter можно фильтровать поля типа ID.

+ `filter=<имя_поля>=<ID>`

Пример ID:
+ `94975104-3cad-11e8-1e44-bd4d00000084`

Например:
+ `filter=productid=94975104-3cad-11e8-1e44-bd4d00000084`

### Фильтрация по дополнительным полям
С помощью filter можно фильтровать по дополнительным полям. Список дополнительных полей сущности указан в ее метаданных
`https://online.moysklad.ru/api/remap/1.2/entity/product/metadata`
Можно использовать следующую конструкцию для того чтобы отфильтровать по дополнительному полю выборку:
+ `filter=<ссылка на доп.поле>=<значение>`

для доп.полей типа справочник:
+ `filter=<ссылка на доп.поле>=<ссылка на сущность>`

Пример ссылки на доп.поле
+ `http://online.moysklad.ru/api/remap/1.2/entity/<type>/metadata/attributes/<id>`

Пример ссылки на сущность:
+ `http://online.moysklad.ru/api/remap/1.2/entity/<type>/<id>`

для доп.полей типа пользовательский справочник
+ `http://online.moysklad.ru/api/remap/1.2/entity/customentity/<customentity_id>/<id>`

Примеры фильтра:
+ `filter=https://online.moysklad.ru/api/remap/1.2/entity/<type>/metadata/attributes/<id>
=42`

+ `filter=https://online.moysklad.ru/api/remap/1.2/entity/<type>/metadata/attributes/<id>
=http://online.moysklad.ru/api/remap/1.2/entity/<type>/<id>`

## Фильтрация по сущностям, на которые нет права просмотра
При фильтрации по сущности, на которую у текущего пользователя нет прав на просмотр в ответе придёт пустой список.
Например, при фильтрации задач (**task**) по автору (**author**), который является сотрудником, которого не может просматривать текущий пользователь,
в ответ вернётся пустой список задач.

## Контекстный поиск
В JSON API можно осуществлять контекстный поиск среди списка сущностей определённого типа по их строковым полям. Для этого
используется URI параметр фильтрации **search**
+ **search**
  Параметр фильтрации, с помощью которого можно осуществить поиск в списке сущностей. Поиск происходит по основным строковым полям сущностей данного
    типа. Результатом поиска будет отсортированный по релевантности список сущностей данного типа, прошедших фильтрацию по переданной поисковой строке. В отличии от фильтрации выборки
    с помощью параметра **filter**, при которой значения проверяются на точное совпадение указанным, при контекстном поиске проверка на совпадение не строгая.
    Таким образом, если осуществлять фильтрацию вида `../entity/<entity_type>?filter=name=120` в отфильтрованную выборку попадут только те сущности, поле **name**
    у которых имеет значение `120` и никакие другие. При контекстном поиске вида `../entity/<entity_type>?search=120` будут выведены как сущности с **name** равным
    `120`, так и сущности, в имени (или в другом строковом поле) которых `120` является началом какого-то слова, например `12003`, `пазл детский 1200 штук` и т.п.
    Причем, если ввести несколько слов `../entity/<entity_type>?search=120 возврат` и поиск идёт по полям **name** и **description**, то будут выведены как сущности с **name** равным `1200` и с **description**
    равным `возврат из-за деффекта`, так и сущности с именем `777` с описанием `розничный возврат на улице 120 летия`.

  + Примеры запросов контекстного поиска (значения должны быть urlencoded):
    - `https://online.moysklad.ru/api/remap/1.2/entity/project?search=реструктуризация`
    - `https://online.moysklad.ru/api/remap/1.2/entity/move?search=ул.Вавилова`
    - `https://online.moysklad.ru/api/remap/1.2/entity/counterparty?search=петров`



## Оператор фильтрации "подобие"
В JSON API для <u>строковых</u> полей есть специальный оператор фильтрации "подобие".
+ `~`  обычное подобие. Ищет любое вхождение подстроки, следующей после оператора, в значении поля. Например, `?filter=code~ms` найдёт все сущности, у которых в коде встречается подстрока "ms".
+ `~=` левое подобие. Ищет соответствие по префиксу значения. Например `?filter=code~=ms` найдёт все сущности, у которых код начинается на "ms".
+ `=~` правое подобие. Ищет соответствие по постфиксу. Например `?filter=code=~ms` найдёт все сущности, у которых код оканчивается на "ms".

Операторы подобия работают исключительно с полями строкового типа и не учитывают регистр. К полям типа uuid и дата-время они неприменимы.

## Вывод JSON с отступами
В JSON API можно получать ответы от сервера в виде pretty-print JSON (JSON с отступами вместо JSON в одну строку). Для этого нужно добавить специальный заголовок к запросу:<br>
`Lognex-Pretty-Print-JSON` со значением `true`.

## Использование цен без округления
В JSON API можно задавать цены позиций и себестоимость с дробными частями копеек. Для этого нужно добавить специальный заголовок к запросу:<br>
`X-Lognex-Precision` со значением `true`.<br>
Если не использовать этот заголовок, цены и себестоимость округляются до копеек.

## Ссылки на файлы
В JSON API для скачивания файла формируется редирект на временный URL файла. Для корректной работы необходимо поддерживать обработку редиректов.

## Замена ссылок объектами с помощью expand [/entity/salesreturn]
> Пример запроса возврата без expand 

```shell
curl -X GET
  "https://online.moysklad.ru/api/remap/1.2/entity/salesreturn/166909e6-4a99-11e6-8a84-bae500000089"
  -H "Authorization: Basic <Access-Token>"
```

> Объект возврата покупателя в его обычном представлении, имеющий ссылку на отгрузку

```json
{
  "meta": {
    "href": "https://online.moysklad.ru/api/remap/1.2/entity/salesreturn/166909e6-4a99-11e6-8a84-bae500000089",
    "metadataHref": "https://online.moysklad.ru/api/remap/1.2/entity/salesreturn/metadata",
    "type": "salesreturn",
    "mediaType": "application/json"
  },
  ...
  "demand": {
    "meta": {
      "href": "https://online.moysklad.ru/api/remap/1.2/entity/demand/f99544d7-4a98-11e6-8a84-bae50000007f",
      "metadataHref": "https://online.moysklad.ru/api/remap/1.2/entity/demand/metadata",
      "type": "demand",
      "mediaType": "application/json"
    }
  }
}
```

> Пример запроса возврата с expand отгрузки
Передаём параметр **expand**=demand.

```shell
curl -X GET
  "https://online.moysklad.ru/api/remap/1.2/entity/salesreturn/166909e6-4a99-11e6-8a84-bae500000089?expand=demand"
  -H "Authorization: Basic <Access-Token>"
```

> В ответ придёт возврат покупателя, у которого вместо ссылки на отгрузку, по которой производится возврат, будет вложенный объект со всеми полями данной отгрузки.

```json
{
  "meta": {
    "href": "https://online.moysklad.ru/api/remap/1.2/entity/salesreturn/166909e6-4a99-11e6-8a84-bae500000089?expand=demand",
    "metadataHref": "https://online.moysklad.ru/api/remap/1.2/entity/salesreturn/metadata",
    "type": "salesreturn",
    "mediaType": "application/json"
  },
  ...
  "demand": {
    "meta": {
      "href": "https://online.moysklad.ru/api/remap/1.2/entity/demand/f99544d7-4a98-11e6-8a84-bae50000007f",
      "metadataHref": "https://online.moysklad.ru/api/remap/1.2/entity/demand/metadata",
      "type": "demand",
      "mediaType": "application/json"
    },
    "id": "f99544d7-4a98-11e6-8a84-bae50000007f",
    "accountId": "f976ed28-2e58-11e6-8a84-bae500000001",
    "owner": {
      "meta": {
        "href": "https://online.moysklad.ru/api/remap/1.2/entity/employee/faba7f37-2e58-11e6-8a84-bae500000028",
        "metadataHref": "https://online.moysklad.ru/api/remap/1.2/entity/employee/metadata",
        "type": "employee",
        "mediaType": "application/json"
      }
    },
    "shared": false,
    "group": {
      "meta": {
        "href": "https://online.moysklad.ru/api/remap/1.2/entity/group/f97aa1fb-2e58-11e6-8a84-bae500000002",
        "metadataHref": "https://online.moysklad.ru/api/remap/1.2/entity/group/metadata",
        "type": "group",
        "mediaType": "application/json"
      }
    },
    ...
    "positions": {
      "meta": {
        "href": "https://online.moysklad.ru/api/remap/1.2/entity/demand/f99544d7-4a98-11e6-8a84-bae50000007f/positions",
        "type": "demandposition",
        "mediaType": "application/json",
        "size": 2,
        "limit": 1000,
        "offset": 0
      }
    },
    "vatEnabled": true,
    "vatIncluded": true,
    "payedSum": 0,
    "returns": [
      {
        "meta": {
          "href": "https://online.moysklad.ru/api/remap/1.2/entity/salesreturn/166909e6-4a99-11e6-8a84-bae500000089",
          "metadataHref": "https://online.moysklad.ru/api/remap/1.2/entity/salesreturn/metadata",
          "type": "salesreturn",
          "mediaType": "application/json"
        }
      }
    ]
  }
}
```

> Пример запроса возврата c expand с глубиной 2 [GET ]
Теперь развернем поле **agent** у вложенной в возврат отгрузки (**demand**).
В ответ придёт возврат покупателя с развёрнутой отгрузкой (**demand**), внутри которой
будет развёрнутый объект контрагента (**agent**). <br>В данном запросе продемонстрирован уровень вложенности
параметра **expand** равный двум.

```shell
curl -X GET
  "https://online.moysklad.ru/api/remap/1.2/entity/salesreturn/166909e6-4a99-11e6-8a84-bae500000089?expand=demand,demand.agent"
  -H "Authorization: Basic <Access-Token>"
```

```json
{
  "meta": {
    "href": "https://online.moysklad.ru/api/remap/1.2/entity/salesreturn/166909e6-4a99-11e6-8a84-bae500000089?expand=demand,demand.agent",
    "metadataHref": "https://online.moysklad.ru/api/remap/1.2/entity/salesreturn/metadata",
    "type": "salesreturn",
    "mediaType": "application/json"
  },
  ...
  "demand": {
    "meta": {
      "href": "https://online.moysklad.ru/api/remap/1.2/entity/demand/f99544d7-4a98-11e6-8a84-bae50000007f?expand=agent",
      "metadataHref": "https://online.moysklad.ru/api/remap/1.2/entity/demand/metadata",
      "type": "demand",
      "mediaType": "application/json"
    },
    ...
    "agent": {
      "meta": {
        "href": "https://online.moysklad.ru/api/remap/1.2/entity/counterparty/147c1f1b-32ca-11e6-8a84-bae500000004",
        "metadataHref": "https://online.moysklad.ru/api/remap/1.2/entity/counterparty/metadata",
        "type": "counterparty",
        "mediaType": "application/json"
      },
      ...
      "name": "Агент1",
      "code": "УТ0003074",
      "externalCode": "kAgs4Xbhiz2Sp5oP2OCaB2",
      "archived": false,
      "legalTitle": "Общество с ограниченной ответственностью «Агент1»",
      "legalAddress": "107023, г. Москва, Барабанный переулок, дом № 42, строение 2",
      "inn": "7719864242",
      "kpp": "771901001",
      ...
    },
    ...
    "positions": {
      "meta": {
        "href": "https://online.moysklad.ru/api/remap/1.2/entity/demand/f99544d7-4a98-11e6-8a84-bae50000007f/positions",
        "type": "demandposition",
        "mediaType": "application/json",
        "size": 2,
        "limit": 1000,
        "offset": 0
      }
    },
    "vatEnabled": true,
    "vatIncluded": true,
    "payedSum": 0,
    "returns": [
      {
        "meta": {
          "href": "https://online.moysklad.ru/api/remap/1.2/entity/salesreturn/166909e6-4a99-11e6-8a84-bae500000089",
          "metadataHref": "https://online.moysklad.ru/api/remap/1.2/entity/salesreturn/metadata",
          "type": "salesreturn",
          "mediaType": "application/json"
        }
      }
    ]
  }
  ...
}
```

> Создание отгрузки с expand [POST /entity/demand?expand=agent]
Развернем поле **agent** у создаваемой отгрузки.

```shell
curl -X POST
  "https://online.moysklad.ru/api/remap/1.2/entity/demand?expand=agent"
  -H "Authorization: Basic <Access-Token>"
  -H 'Content-Type: application/json' \
  -d '{
  "name": "0001",
  "organization": {
    "meta": {
      "href": "https://online.moysklad.ru/api/remap/1.2/entity/organization/850c8195-f504-11e5-8a84-bae50000015e",
      "type": "organization",
      "mediaType": "application/json"
    }
  },
  "agent": {
    "meta": {
      "href": "https://online.moysklad.ru/api/remap/1.2/entity/counterparty/9794d400-f689-11e5-8a84-bae500000078",
      "type": "counterparty",
      "mediaType": "application/json"
    }
  },
  "store": {
    "meta": {
      "href": "https://online.moysklad.ru/api/remap/1.2/entity/store/850ee995-f504-11e5-8a84-bae500000160",
      "type": "store",
      "mediaType": "application/json"
    }
  }
}'
```

> В ответ придёт созданная отгрузка с развёрнутым объектом контрагента (**agent**).

```json
{
    "meta": {
        "href": "https://online.moysklad.ru/api/remap/1.2/entity/demand/1c3f30d2-88b9-11e7-9464-e4de00000000",
        "metadataHref": "https://online.moysklad.ru/api/remap/1.2/entity/demand/metadata",
        "type": "demand",
        "mediaType": "application/json",
        "uuidHref": "https://online.moysklad.ru/app/#demand/edit?id=1c3f30d2-88b9-11e7-9464-e4de00000000"
    },
    "id": "1c3f30d2-88b9-11e7-9464-e4de00000000",
    "accountId": "d8a2e973-6703-11e7-9464-e4de00000001",
    "owner": {
        "meta": {
            "href": "https://online.moysklad.ru/api/remap/1.2/entity/employee/d9335bf2-6703-11e7-9464-e4de0000002a",
            "metadataHref": "https://online.moysklad.ru/api/remap/1.2/entity/employee/metadata",
            "type": "employee",
            "mediaType": "application/json",
            "uuidHref": "https://online.moysklad.ru/app/#employee/edit?id=d9335bf2-6703-11e7-9464-e4de0000002a"
        }
    },
    "shared": false,
    "group": {
        "meta": {
            "href": "https://online.moysklad.ru/api/remap/1.2/entity/group/d8a5d385-6703-11e7-9464-e4de00000002",
            "metadataHref": "https://online.moysklad.ru/api/remap/1.2/entity/group/metadata",
            "type": "group",
            "mediaType": "application/json"
        }
    },
    "updated": "2017-08-24 13:43:47",
    "name": "0001",
    "externalCode": "UoaXR1oZhS9LOHzdUi42R1",
    "moment": "2017-08-24 13:43:00",
    "applicable": true,
    "rate": {
        "currency": {
            "meta": {
                "href": "https://online.moysklad.ru/api/remap/1.2/entity/currency/d959dce8-6703-11e7-9464-e4de00000058",
                "metadataHref": "https://online.moysklad.ru/api/remap/1.2/entity/currency/metadata",
                "type": "currency",
                "mediaType": "application/json",
                "uuidHref": "https://online.moysklad.ru/app/#currency/edit?id=d959dce8-6703-11e7-9464-e4de00000058"
            }
        }
    },
    "sum": 0,
    "store": {
        "meta": {
            "href": "https://online.moysklad.ru/api/remap/1.2/entity/store/d95915ff-6703-11e7-9464-e4de00000053",
            "metadataHref": "https://online.moysklad.ru/api/remap/1.2/entity/store/metadata",
            "type": "store",
            "mediaType": "application/json",
            "uuidHref": "https://online.moysklad.ru/app/#warehouse/edit?id=d95915ff-6703-11e7-9464-e4de00000053"
        }
    },
    "agent": {
        "meta": {
            "href": "https://online.moysklad.ru/api/remap/1.2/entity/counterparty/d9593e70-6703-11e7-9464-e4de00000054",
            "metadataHref": "https://online.moysklad.ru/api/remap/1.2/entity/counterparty/metadata",
            "type": "counterparty",
            "mediaType": "application/json",
            "uuidHref": "https://online.moysklad.ru/app/#company/edit?id=d9593e70-6703-11e7-9464-e4de00000054"
        },
        "id": "d9593e70-6703-11e7-9464-e4de00000054",
        "accountId": "d8a2e973-6703-11e7-9464-e4de00000001",
        "owner": {
            "meta": {
                "href": "https://online.moysklad.ru/api/remap/1.2/entity/employee/d9335bf2-6703-11e7-9464-e4de0000002a",
                "metadataHref": "https://online.moysklad.ru/api/remap/1.2/entity/employee/metadata",
                "type": "employee",
                "mediaType": "application/json",
                "uuidHref": "https://online.moysklad.ru/app/#employee/edit?id=d9335bf2-6703-11e7-9464-e4de0000002a"
            }
        },
        "shared": false,
        "group": {
            "meta": {
                "href": "https://online.moysklad.ru/api/remap/1.2/entity/group/d8a5d385-6703-11e7-9464-e4de00000002",
                "metadataHref": "https://online.moysklad.ru/api/remap/1.2/entity/group/metadata",
                "type": "group",
                "mediaType": "application/json"
            }
        },
        "updated": "2017-08-18 17:49:23",
        "name": "ООО \"Поставщик\"",
        "externalCode": "YWKWXePEi9jBAmxriBpc93",
        "archived": false,
        "created": "2017-07-12 16:13:08",
        "companyType": "legal",
        "legalTitle": "Общество с ограниченной ответственностью \"Поставщик\"",
        "legalAddress": "г.Москва, ул.Строителей, д.12",
        "inn": "7736570901",
        "kpp": "773601001",
        "accounts": {
            "meta": {
                "href": "https://online.moysklad.ru/api/remap/1.2/entity/counterparty/d9593e70-6703-11e7-9464-e4de00000054/accounts",
                "type": "account",
                "mediaType": "application/json",
                "size": 0,
                "limit": 1000,
                "offset": 0
            }
        },
        "tags": [
            "bbbvcc",
            "ss"
        ],
        "contactpersons": {
            "meta": {
                "href": "https://online.moysklad.ru/api/remap/1.2/entity/counterparty/d9593e70-6703-11e7-9464-e4de00000054/contactpersons",
                "type": "contactperson",
                "mediaType": "application/json",
                "size": 0,
                "limit": 1000,
                "offset": 0
            }
        },
        "notes": {
            "meta": {
                "href": "https://online.moysklad.ru/api/remap/1.2/entity/counterparty/d9593e70-6703-11e7-9464-e4de00000054/notes",
                "type": "note",
                "mediaType": "application/json",
                "size": 0,
                "limit": 1000,
                "offset": 0
            }
        },
        "state": {
            "meta": {
                "href": "https://online.moysklad.ru/api/remap/1.2/entity/counterparty/metadata/states/d9efdc3b-6703-11e7-9464-e4de00000066",
                "metadataHref": "https://online.moysklad.ru/api/remap/1.2/entity/counterparty/metadata",
                "type": "state",
                "mediaType": "application/json"
            }
        },
        "salesAmount": 4500
    },
    "organization": {
        "meta": {
            "href": "https://online.moysklad.ru/api/remap/1.2/entity/organization/d955aa70-6703-11e7-9464-e4de00000051",
            "metadataHref": "https://online.moysklad.ru/api/remap/1.2/entity/organization/metadata",
            "type": "organization",
            "mediaType": "application/json",
            "uuidHref": "https://online.moysklad.ru/app/#mycompany/edit?id=d955aa70-6703-11e7-9464-e4de00000051"
        }
    },
    "created": "2017-08-24 13:43:48",
    "positions": {
        "meta": {
            "href": "https://online.moysklad.ru/api/remap/1.2/entity/demand/1c3f30d2-88b9-11e7-9464-e4de00000000/positions",
            "type": "demandposition",
            "mediaType": "application/json",
            "size": 0,
            "limit": 1000,
            "offset": 0
        }
    },
    "vatEnabled": true,
    "vatIncluded": true,
    "vatSum": 0,
    "payedSum": 0
}
```

> Редактирование отгрузки с expand [PUT /entity/demand/1c3f30d2-88b9-11e7-9464-e4de00000000?expand=agent,organization]
Теперь обновим эту отгрузку и развернем у неё поля **agent** и **organization**.
В ответ придёт изменённая отгрузка с развёрнутым объектом контрагента (**agent**) и развёрнутым объектом юрлица (**organization**).

```shell
curl -X PUT
  "https://online.moysklad.ru/api/remap/1.2/entity/demand/1c3f30d2-88b9-11e7-9464-e4de00000000?expand=agent,organization"
  -H "Authorization: Basic <Access-Token>"
  -H 'Content-Type: application/json' \
  -d '{
  "name": "3738"
}`
```

> Response 200 (application/json)

```json
{
    "meta": {
        "href": "https://online.moysklad.ru/api/remap/1.2/entity/demand/1c3f30d2-88b9-11e7-9464-e4de00000000?expand=agent,organization",
        "metadataHref": "https://online.moysklad.ru/api/remap/1.2/entity/demand/metadata",
        "type": "demand",
        "mediaType": "application/json",
        "uuidHref": "https://online.moysklad.ru/app/#demand/edit?id=1c3f30d2-88b9-11e7-9464-e4de00000000"
    },
    "id": "1c3f30d2-88b9-11e7-9464-e4de00000000",
    "accountId": "d8a2e973-6703-11e7-9464-e4de00000001",
    "owner": {
        "meta": {
            "href": "https://online.moysklad.ru/api/remap/1.2/entity/employee/d9335bf2-6703-11e7-9464-e4de0000002a",
            "metadataHref": "https://online.moysklad.ru/api/remap/1.2/entity/employee/metadata",
            "type": "employee",
            "mediaType": "application/json",
            "uuidHref": "https://online.moysklad.ru/app/#employee/edit?id=d9335bf2-6703-11e7-9464-e4de0000002a"
        }
    },
    "shared": false,
    "group": {
        "meta": {
            "href": "https://online.moysklad.ru/api/remap/1.2/entity/group/d8a5d385-6703-11e7-9464-e4de00000002",
            "metadataHref": "https://online.moysklad.ru/api/remap/1.2/entity/group/metadata",
            "type": "group",
            "mediaType": "application/json"
        }
    },
    "updated": "2017-08-24 13:53:07",
    "name": "3738",
    "externalCode": "UoaXR1oZhS9LOHzdUi42R1",
    "moment": "2017-08-24 13:43:00",
    "applicable": true,
    "rate": {
        "currency": {
            "meta": {
                "href": "https://online.moysklad.ru/api/remap/1.2/entity/currency/d959dce8-6703-11e7-9464-e4de00000058",
                "metadataHref": "https://online.moysklad.ru/api/remap/1.2/entity/currency/metadata",
                "type": "currency",
                "mediaType": "application/json",
                "uuidHref": "https://online.moysklad.ru/app/#currency/edit?id=d959dce8-6703-11e7-9464-e4de00000058"
            }
        }
    },
    "sum": 0,
    "store": {
        "meta": {
            "href": "https://online.moysklad.ru/api/remap/1.2/entity/store/d95915ff-6703-11e7-9464-e4de00000053",
            "metadataHref": "https://online.moysklad.ru/api/remap/1.2/entity/store/metadata",
            "type": "store",
            "mediaType": "application/json",
            "uuidHref": "https://online.moysklad.ru/app/#warehouse/edit?id=d95915ff-6703-11e7-9464-e4de00000053"
        }
    },
    "agent": {
        "meta": {
            "href": "https://online.moysklad.ru/api/remap/1.2/entity/counterparty/d9593e70-6703-11e7-9464-e4de00000054",
            "metadataHref": "https://online.moysklad.ru/api/remap/1.2/entity/counterparty/metadata",
            "type": "counterparty",
            "mediaType": "application/json",
            "uuidHref": "https://online.moysklad.ru/app/#company/edit?id=d9593e70-6703-11e7-9464-e4de00000054"
        },
        "id": "d9593e70-6703-11e7-9464-e4de00000054",
        "accountId": "d8a2e973-6703-11e7-9464-e4de00000001",
        "owner": {
            "meta": {
                "href": "https://online.moysklad.ru/api/remap/1.2/entity/employee/d9335bf2-6703-11e7-9464-e4de0000002a",
                "metadataHref": "https://online.moysklad.ru/api/remap/1.2/entity/employee/metadata",
                "type": "employee",
                "mediaType": "application/json",
                "uuidHref": "https://online.moysklad.ru/app/#employee/edit?id=d9335bf2-6703-11e7-9464-e4de0000002a"
            }
        },
        "shared": false,
        "group": {
            "meta": {
                "href": "https://online.moysklad.ru/api/remap/1.2/entity/group/d8a5d385-6703-11e7-9464-e4de00000002",
                "metadataHref": "https://online.moysklad.ru/api/remap/1.2/entity/group/metadata",
                "type": "group",
                "mediaType": "application/json"
            }
        },
        "updated": "2017-08-18 17:49:23",
        "name": "ООО \"Поставщик\"",
        "externalCode": "YWKWXePEi9jBAmxriBpc93",
        "archived": false,
        "created": "2017-07-12 16:13:08",
        "companyType": "legal",
        "legalTitle": "Общество с ограниченной ответственностью \"Поставщик\"",
        "legalAddress": "г.Москва, ул.Строителей, д.12",
        "inn": "7736570901",
        "kpp": "773601001",
        "accounts": {
            "meta": {
                "href": "https://online.moysklad.ru/api/remap/1.2/entity/counterparty/d9593e70-6703-11e7-9464-e4de00000054/accounts",
                "type": "account",
                "mediaType": "application/json",
                "size": 0,
                "limit": 1000,
                "offset": 0
            }
        },
        "tags": [
            "bbbvcc",
            "ss"
        ],
        "contactpersons": {
            "meta": {
                "href": "https://online.moysklad.ru/api/remap/1.2/entity/counterparty/d9593e70-6703-11e7-9464-e4de00000054/contactpersons",
                "type": "contactperson",
                "mediaType": "application/json",
                "size": 0,
                "limit": 1000,
                "offset": 0
            }
        },
        "notes": {
            "meta": {
                "href": "https://online.moysklad.ru/api/remap/1.2/entity/counterparty/d9593e70-6703-11e7-9464-e4de00000054/notes",
                "type": "note",
                "mediaType": "application/json",
                "size": 0,
                "limit": 1000,
                "offset": 0
            }
        },
        "state": {
            "meta": {
                "href": "https://online.moysklad.ru/api/remap/1.2/entity/counterparty/metadata/states/d9efdc3b-6703-11e7-9464-e4de00000066",
                "metadataHref": "https://online.moysklad.ru/api/remap/1.2/entity/counterparty/metadata",
                "type": "state",
                "mediaType": "application/json"
            }
        },
        "salesAmount": 4500
    },
    "organization": {
        "meta": {
            "href": "https://online.moysklad.ru/api/remap/1.2/entity/organization/d955aa70-6703-11e7-9464-e4de00000051",
            "metadataHref": "https://online.moysklad.ru/api/remap/1.2/entity/organization/metadata",
            "type": "organization",
            "mediaType": "application/json",
            "uuidHref": "https://online.moysklad.ru/app/#mycompany/edit?id=d955aa70-6703-11e7-9464-e4de00000051"
        },
        "id": "d955aa70-6703-11e7-9464-e4de00000051",
        "accountId": "d8a2e973-6703-11e7-9464-e4de00000001",
        "owner": {
            "meta": {
                "href": "https://online.moysklad.ru/api/remap/1.2/entity/employee/d9335bf2-6703-11e7-9464-e4de0000002a",
                "metadataHref": "https://online.moysklad.ru/api/remap/1.2/entity/employee/metadata",
                "type": "employee",
                "mediaType": "application/json",
                "uuidHref": "https://online.moysklad.ru/app/#employee/edit?id=d9335bf2-6703-11e7-9464-e4de0000002a"
            }
        },
        "shared": true,
        "group": {
            "meta": {
                "href": "https://online.moysklad.ru/api/remap/1.2/entity/group/d8a5d385-6703-11e7-9464-e4de00000002",
                "metadataHref": "https://online.moysklad.ru/api/remap/1.2/entity/group/metadata",
                "type": "group",
                "mediaType": "application/json"
            }
        },
        "updated": "2017-07-12 16:13:09",
        "name": "reqwy",
        "externalCode": "PRLKDfmQgwj7TGtiYWrrZ3",
        "archived": false,
        "created": "2017-07-12 16:13:08",
        "companyType": "legal",
        "legalTitle": "reqwy",
        "email": "erqw@ss.ru",
        "accounts": {
            "meta": {
                "href": "https://online.moysklad.ru/api/remap/1.2/entity/organization/d955aa70-6703-11e7-9464-e4de00000051/accounts",
                "type": "account",
                "mediaType": "application/json",
                "size": 0,
                "limit": 1000,
                "offset": 0
            }
        },
        "isEgaisEnable": false,
        "payerVat": true,
        "director": "Администратор",
        "chiefAccountant": "Администратор"
    },
    "created": "2017-08-24 13:43:48",
    "positions": {
        "meta": {
            "href": "https://online.moysklad.ru/api/remap/1.2/entity/demand/1c3f30d2-88b9-11e7-9464-e4de00000000/positions",
            "type": "demandposition",
            "mediaType": "application/json",
            "size": 0,
            "limit": 1000,
            "offset": 0
        }
    },
    "vatEnabled": true,
    "vatIncluded": true,
    "vatSum": 0,
    "payedSum": 0
}
```

В JSON API, в составе сущностей можно встретить ссылки на связанные объекты.
Ссылки выводятся в формате [Метаданных](/api/remap/1.2/doc/index.html#header-метаданные). Для того, чтобы вместо ссылок получить связанные объекты,
не обязательно делать отдельные запросы для каждого из них. Вместо этого, вместе с запросом на получение сущности, нужно передать параметр **expand**.
В качестве значения данного параметра нужно перечислить через запятую все необходимые поля-ссылки,
на месте которых вы бы хотели видеть связанные объекты.
В результате запроса с таким параметром, в ответе вы получите объект с развернутыми вложенными объектами вместо ссылок.
К примеру, в документах, имеющих в составе поле **agent**, вместо ссылки на
контрагента будет выведен объект со всеми полями сущности "Контрагент", описанными [тут](/api/remap/1.2/doc/counterparty.html#контрагент-контрагенты-get).
Максимальный уровень вложенности **expand** : 3.
Expand разрешен только на размере выборки не более 100. Если указан больший лимит, но указан expand, то данный параметр будет игнорироваться.

Также **expand** можно применять для результатов операций создания и обновления.

В примерах представлены только поля **meta** и **demand**.

