<!-- include(metadata.apib) -->

# Документ Внутренний заказ
Средствами JSON API можно создавать и обновлять сведения о внутренних заказах, запрашивать списки внутренних заказов и сведения по отдельным внутренним заказам. Позициями внутренних заказов можно управлять как в составе отдельного заказа, так и с помощью специальных ресурсов для управления позициями. Кодом сущности для внутреннего заказа в составе JSON API является ключевое слово **internalorder**.

## Внутренние заказы [/entity/internalorder]
### Атрибуты сущности
+ **meta** - [Метаданные](/api/remap/1.2/doc/index.html#header-метаданные) о внутреннем заказе
+ **id** - ID в формате UUID `Только для чтения`
+ **accountId** - ID учетной записи `Только для чтения`
+ **syncId** - ID синхронизации. После заполнения недоступен для изменения.
+ **updated** - Момент последнего обновления сущности `Только для чтения`
+ **deleted** - Момент последнего удаления сущности `Только для чтения`
+ **name** - номер внутреннего заказа `Необходимое`
+ **description** - Комментарий к внутреннему заказу
+ **externalCode** - Внешний код внутреннего заказа
+ **moment** - Дата внутреннего заказа
+ **applicable** - Отметка о проведении
+ **sum** - Сумма внутреннего заказа в копейках `Только для чтения`
+ **rate** - Валюта
+ **owner** - Ссылка на Владельца (Сотрудника) в формате [Метаданных](/api/remap/1.2/doc/index.html#header-метаданные)
+ **shared** - Общий доступ
+ **group** - Отдел сотрудника в формате [Метаданных](/api/remap/1.2/doc/index.html#header-метаданные)
+ **organization** - Ссылка на ваше юрлицо в формате [Метаданных](/api/remap/1.2/doc/index.html#header-метаданные) `Необходимое`
+ **store** - Ссылка на склад в формате [Метаданных](/api/remap/1.2/doc/index.html#header-метаданные)
+ **project** - Ссылка на проект в формате [Метаданных](/api/remap/1.2/doc/index.html#header-метаданные)
+ **state** - Статус внутреннего заказа в формате [Метаданных](/api/remap/1.2/doc/index.html#header-метаданные)
+ **attributes** - Коллекция доп. полей в формате [Метаданных](/api/remap/1.2/doc/index.html#header-метаданные)
<br>Поля при expand'е:</br>
  - **name** - номер документа
  - **moment** - дата печати
  - **href** - ссылка на файл печатной формы
  - **fileName** - название файла печатной формы
  - **updated** - дата последнего изменения
+ **created** - Дата создания `Только для чтения`
+ **positions** - Ссылка на позиции внутреннего заказа в формате [Метаданных](/api/remap/1.2/doc/index.html#header-метаданные)
+ **vatSum** - Сумма НДС `Только для чтения`
+ **vatEnabled** - Учитывается ли НДС
+ **vatIncluded** - Включен ли НДС в цену
+ **deliveryPlannedMoment** - Планируемая дата приёмки
+ **purchaseOrders** - Коллекция ссылок на связанные заказы поставщику в формате [Метаданных](/api/remap/1.2/doc/index.html#header-метаданные)
+ **moves** - Коллекция ссылок на связанные перемещения в формате [Метаданных](/api/remap/1.2/doc/index.html#header-метаданные)

### Позиции внутреннего заказа
Позиции внутреннего заказа - это список товаров/услуг/модификаций/серий.
Объект позиции внутреннего заказа содержит следующие поля:
+ **id** - ID товара в формате UUID `Только для чтения`
+ **accountId** - ID учетной записи `Только для чтения`
+ **quantity** - Фактическое количество товаров/услуг/модификаций/серий.
+ **price** - Цена товара/услуги в копейках
+ **vat** - НДС
+ **assortment** - Ссылка на товар/услугу/серию/модификацию, которую представляет собой позиция. в формате [Метаданных](/api/remap/1.2/doc/index.html#header-метаданные)
+ **pack** - Упаковка товара

С позициями можно работать с помощью [специальных ресурсов для управления позициями Внутреннего заказа](#документ-внутренний-заказ-позиции-внутреннего-заказа),
а также в составе отдельного внутреннего заказа. При работе в составе отдельного внутреннего заказа,
вы можете отправлять запросы на создание отдельного внутреннего заказа с включенным в тело запроса
массивом позиций внутреннего заказа. Если количество позиций превышает максимально допустимое, то для
дальнейшего пополнения позиций нужно будет работать со специальным ресурсом "Позиции внутреннего заказа".
Также, при работе в составе отдельного внутреннего заказа, можно отправлять запросы на обновление списка позиций
с включенным в тело запроса массивом позиций внутреннего заказа. При этом важно помнить, что коллекция позиций будет
восприниматься как "все позиции внутреннего заказа" и полностью заменит уже существующую коллекцию при обновлении объекта - лишние
позиции будут удалены, новые добавлены, существующие - изменены.

<!-- include(rate.apib) -->

О работе с доп. полями внутренних заказов можно прочитать [здесь](/api/remap/1.2/doc/index.html#header-работа-с-дополнительными-полями)


### Получить внутренние заказы [GET]
+ Parameters
  + limit: 1000 (optional, enum[number])
  Максимальное количество сущностей для извлечения.
  <p>
    <code>Допустимые значения 1 - 1000</code>
  </p>
      + Default: `1000`
  + offset: 40 (optional, number)
    Отступ в выдаваемом списке сущностей
      + Default: `0`

  + search: `0001` (optional, string)
    URL Параметр для поиска по имени документа.
    Фильтр документов по указанной поисковой строке. Фильтрация происходит по
    полю name.

+ Response 200 (application/json)
Успешный запрос. Результат - JSON представление списка внутренних заказов.
  + Body
        <!-- include(body/internalorder/get_list.json) -->

### Создать внутренний заказ [POST]
Запрос на создание нового внутреннего заказа.
+ Request Пример (application/json)
Пример создания нового внутреннего заказа.
  + Body
        <!-- include(body/internalorder/post_request.json) -->

+ Response 200 (application/json)
Успешный запрос. Результат - JSON представление созданного внутреннего заказа.
  + Body
        <!-- include(body/internalorder/post_response.json) -->

## Шаблон внутреннего заказа [/entity/internalorder/new]
### Шаблон внутреннего заказа [PUT]
Запрос на получение шаблона внутреннего заказа.

+ Request Пример (application/json)
Пример создания нового внутреннего заказа.
  + Body

+ Response 200 (application/json)
Успешный запрос. Результат - JSON представление предзаполненного шаблона внутреннего заказа.
  + Body
        <!-- include(body/internalorder/new.json) -->

### Массовое создание и обновление внутренних заказов [POST]
[Массовое создание и обновление](/api/remap/1.2/doc/index.html#header-создание-и-обновление-нескольких-объектов) внутренних заказов.
В теле запроса нужно передать массив, содержащий JSON представления внутренних заказов, которые вы хотите создать или обновить.
Обновляемые внутренние заказы должны содержать идентификатор в виде метаданных.

+ Request Пример (application/json)
Пример создания и обновления нескольких внутренних заказов
  + Body
        <!-- include(body/internalorder/post_massive_request.json) -->

+ Response 200 (application/json)
Успешный запрос. Результат - массив JSON представлений созданных и обновленных внутренних заказов.
  + Body
        <!-- include(body/internalorder/post_massive_response.json) -->


### Удалить внутренний заказ [DELETE /entity/internalorder/{id}]
+ Parameters
  + id: `7944ef04-f831-11e5-7a69-971500188b19` (required, string) - id внутреннего заказа

Запрос на удаление внутреннего заказа с указанным id.
+ Response 200 (application/json)
Успешное удаление внутреннего заказа.

## Метаданные внутренних заказов [/entity/internalorder/metadata]
### Метаданные внутренних заказов [GET]
Запрос на получение метаданных внутренних заказов. Результат - объект JSON, включающий в себя:
+ **meta** - Ссылка на метаданные внутренних заказов
+ **attributes** - Массив объектов доп. полей внутренних заказов в формате [Метаданных](/api/remap/1.2/doc/index.html#header-метаданные)
+ **states** - Массив статусов внутренних заказов
+ **createShared** - создавать новые внутренние заказы с меткой "Общий"

Структура отдельного объекта, представляющего доп. поле подробно описана в разделе [Работа с дополнительными полями](/api/remap/1.2/doc/index.html#header-работа-с-дополнительными-полями).

+ Response 200 (application/json)
Успешный запрос. Результат - JSON представление метаданных внутренних заказов.
  + Body
        <!-- include(body/internalorder/get_metadata.json) -->

## Отдельное доп. поле [/entity/internalorder/metadata/attributes/{id}]
+ Parameters
  + id: `7944ef04-f831-11e5-7a69-971500188b19` (required, string) - id Доп. поля

### Отдельное доп. поле [GET]
Запрос на получение информации по отдельному дополнительному полю.
+ Response 200 (application/json)
Успешный запрос. Результат - JSON представление отдельного доп. поля.
  + Body
        <!-- include(body/internalorder/metadata_by_id.json) -->

## Внутренний заказ [/entity/internalorder/{id}]

+ Parameters
  + id: `7944ef04-f831-11e5-7a69-971500188b19` (required, string) - id внутреннего заказа

### Получить внутренний заказ [GET]
Запрос на получение отдельного внутреннего заказа с указанным id.
+ Response 200 (application/json)
Успешный запрос. Результат - JSON представление внутреннего заказа.
  + Body
        <!-- include(body/internalorder/get_by_id.json) -->

### Изменить внутренний заказ [PUT]
Запрос на обновление внутреннего заказа с указанным id.
+ Request Пример (application/json)
Пример запроса на обновление отдельного внутреннего заказа.
  + Body
        <!-- include(body/internalorder/put_request.json) -->

+ Response 200 (application/json)
Успешный запрос. Результат - JSON представление обновлённого внутреннего заказа.
  + Body
        <!-- include(body/internalorder/put_response.json) -->

## Позиции внутреннего заказа [/entity/internalorder/{id}/positions]
Отдельный ресурс для управления позициями внутреннего заказа. С его помощью вы можете управлять позициями большого документа, количество строк в котором превышает 100. Более подробно о лимитах на количество строк документа и работе с большими документами можно прочитать [тут](/api/remap/1.2/doc/index.html#header-работа-с-позициями-документов).

+ Parameters
  + id: `7944ef04-f831-11e5-7a69-971500188b19` (required, string) - id внутреннего заказа

### Получить позиции внутреннего заказа [GET]
Запрос на получение списка всех позиций данного внутреннего заказа.
- **meta** [Метаданные](/api/remap/1.2/doc/index.html#header-метаданные) о выдаче,
- **context** - [Метаданные](/api/remap/1.2/doc/index.html#header-метаданные) о сотруднике, выполнившем запрос.
- **rows** - Массив JSON объектов, представляющих собой позиции внутреннего заказа.
+ Parameters
  + limit: 1000 (optional, enum[number])
  Максимальное количество сущностей для извлечения.
  <p>
    <code>Допустимые значения 1 - 1000</code>
  </p>
      + Default: `1000`
  + offset: 40 (optional, number)
    Отступ в выдаваемом списке сущностей
      + Default: `0`

  + search: `0001` (optional, string)
    URL Параметр для поиска по имени документа.
    Фильтр документов по указанной поисковой строке. Фильтрация происходит по
    полю name.

+ Response 200 (application/json)
Успешный запрос. Результат - JSON представление списка позиций отдельного внутреннего заказа.
  + Body
        <!-- include(body/internalorder/positions_get_list.json) -->

### Создать позиции внутреннего заказа [POST]
Запрос на создание новой позиции во внутреннем заказе.
Для успешного создания необходимо в теле запроса указать следующие поля:
+ **assortment** - Ссылка на товар/услугу/серию/модификацию, которую представляет собой позиция.
Также можно указать поле с именем **service**, **consignment**, **variant** в соответствии с тем,
чем является указанная позиция. Подробнее об этом поле можно прочитать в описании [позиции внутреннего заказа](#header-позиции-внутреннего-заказа)
+ **quantity** - Количество указанной позиции. Должно быть положительным, иначе возникнет ошибка.
Одновременно можно создать как одну так и несколько позиций внутреннего заказа. Все созданные данным запросом позиции
будут добавлены к уже существующим.

+ Request Пример (application/json)
Пример создания позиций во внутреннем заказе.
  + Body
        <!-- include(body/internalorder/positions_post_request.json) -->

+ Response 200 (application/json)
Успешный запрос. Результат - JSON представление созданной позиции отдельного внутреннего заказа.
  + Body
        <!-- include(body/internalorder/positions_post_response.json) -->

### Удалить позицию внутреннего заказа [DELETE /entity/internalorder/{id}/positions/{positionID}]

+ Parameters
  + positionID: `7944ef04-f831-11e5-7a69-971500188b19` (required, string) - id позиции внутреннего заказа

Запрос на удаление позиции внутреннего заказа с указанным id.
+ Response 200 (application/json)
Успешное удаление позиции внутреннего заказа.

## Позиция внутреннего заказа [/entity/internalorder/{id}/positions/{positionID}]

+ Parameters
  + id: `7944ef04-f831-11e5-7a69-971500188b19` (required, string) - id внутреннего заказа
  + positionID: `7944ef04-f831-11e5-7a69-971500188b19` (required, string) - id позиции внутреннего заказа

### Получить позицию [GET]

Запрос на получение отдельной позиции внутреннего заказа с указанным id.
+ Response 200 (application/json)
Успешный запрос. Результат - JSON представление отдельной позиции внутреннего заказа.
  + Body
        <!-- include(body/internalorder/positions_get_by_id.json) -->

### Изменить позицию [PUT]
Запрос на обновление отдельной позиции внутреннего заказа.

+ Request Пример (application/json)
Пример запроса на обновление отдельной позиции во внутреннем заказе.
  + Body
        <!-- include(body/internalorder/position_put_request.json) -->

+ Response 200 (application/json)
Успешный запрос. Результат - JSON представление обновлённой позиции заказа.
  + Body
        <!-- include(body/internalorder/position_put_response.json) -->
