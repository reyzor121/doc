<!-- include(metadata.apib) -->

# Документ Счёт покупателю
## Счета покупателям [/entity/invoiceout]
Средствами JSON API можно создавать и обновлять сведения о Счёте покупателю, запрашивать списки Счетов и сведения по отдельным Счетам Покупателям. Позициями Счетов можно управлять как в составе отдельного Счёта, так и отдельно - с помощью специальных ресурсов для управления позициями Счёта. Кодом сущности для Счёта покупателю в составе JSON API является ключевое слово **invoiceout**. Больше о Счетах Покупателям и работе с ними в основном интерфейсе вы можете прочитать в нашей службе поддержки по [этой ссылке](https://support.moysklad.ru/hc/ru/articles/203053496-%D0%A1%D1%87%D0%B5%D1%82%D0%B0-%D0%BF%D0%BE%D0%BA%D1%83%D0%BF%D0%B0%D1%82%D0%B5%D0%BB%D1%8F%D0%BC).

### Атрибуты сущности
+ **meta** - [Метаданные](/api/remap/1.2/doc/index.html#header-метаданные) о Счёте покупателю
+ **id** - ID в формате UUID `Только для чтения`
+ **accountId** - ID учетной записи `Только для чтения`
+ **syncId** - ID синхронизации. После заполнения недоступен для изменения.
+ **updated** - Момент последнего обновления сущности `Только для чтения`
+ **deleted** - Момент последнего удаления сущности `Только для чтения`
+ **name** - номер Счёта покупателю
+ **description** - Комментарий Счёта покупателю
+ **externalCode** - Внешний код Счёта покупателю
+ **moment** - Дата Счёта
+ **applicable** - Отметка о проведении
+ **vatEnabled** - Учитывается ли НДС
+ **vatIncluded** - Включен ли НДС в цену
+ **sum** - Сумма Счёта в установленной валюте `Только для чтения`
+ **rate** - Валюта
+ **owner** - Ссылка на Владельца (Сотрудника) в формате [Метаданных](/api/remap/1.2/doc/index.html#header-метаданные)
+ **shared** - Общий доступ
+ **group** - Отдел сотрудника в формате [Метаданных](/api/remap/1.2/doc/index.html#header-метаданные)
+ **organization** - Ссылка на ваше юрлицо в формате [Метаданных](/api/remap/1.2/doc/index.html#header-метаданные) `Необходимое`
+ **agent** - Ссылка на контрагента в формате [Метаданных](/api/remap/1.2/doc/index.html#header-метаданные) `Необходимое`
+ **store** - Ссылка на склад в формате [Метаданных](/api/remap/1.2/doc/index.html#header-метаданные)
+ **contract** - Ссылка на договор в формате [Метаданных](/api/remap/1.2/doc/index.html#header-метаданные)
+ **state** - Статус Счёта в формате [Метаданных](/api/remap/1.2/doc/index.html#header-метаданные)
+ **organizationAccount** - Ссылка на счёт вашего юрлица в формате [Метаданных](/api/remap/1.2/doc/index.html#header-метаданные)
+ **agentAccount** - Ссылка на счёт контрагента в формате [Метаданных](/api/remap/1.2/doc/index.html#header-метаданные)
+ **attributes** - Коллекция доп. полей в формате [Метаданных](/api/remap/1.2/doc/index.html#header-метаданные)
<br>Поля при expand'е:</br>
  - **name** - номер документа
  - **moment** - дата печати
  - **href** - ссылка на файл печатной формы
  - **fileName** - название файла печатной формы
  - **updated** - дата последнего изменения
+ **created** - Дата создания `Только для чтения`
+ **vatSum** - Сумма НДС `Только для чтения`
+ **positions** - Ссылка на позиции в Счёте в формате [Метаданных](/api/remap/1.2/doc/index.html#header-метаданные)
+ **paymentPlannedMoment** - Планируемая дата оплаты
+ **payedSum** - Сумма входящих платежей по Счёту покупателю `Только для чтения`
+ **shippedSum** - Сумма отгруженного `Только для чтения`
+ **project** - Ссылка на проект в формате [Метаданных](/api/remap/1.2/doc/index.html#header-метаданные)
### Связи с другими документами
+ **customerOrder** - Ссылка на Заказ Покупателя, с которым связан этот Счёт покупателю в формате [Метаданных](/api/remap/1.2/doc/index.html#header-метаданные)
+ **payments** - Массив ссылок на связанные операции в формате [Метаданных](/api/remap/1.2/doc/index.html#header-метаданные) `Только для чтения`
+ **demands** - Массив ссылок на связанные отгрузки в формате [Метаданных](/api/remap/1.2/doc/index.html#header-метаданные)

### Позиции Счёта покупателю
Позиции Счёта - это список товаров/услуг/модификаций/серий.
Объект позиции Счёта содержит следующие поля:
+ **id** - ID товара в формате UUID `Только для чтения`
+ **accountId** - ID учетной записи `Только для чтения`
+ **quantity** - Количество товаров/услуг данного вида в позиции. Если позиция - товар, у которого включен учёт по серийным номерам, то значение в этом поле всегда будет равно количеству серийных номеров для данной позиции в документе.
+ **price** - Цена товара/услуги в копейках
+ **discount** - Процент скидки или наценки. Наценка указывается отрицательным числом, т.е. -10 создаст наценку в 10%
+ **vat** - НДС, которым облагается текущая позиция
+ **assortment** - Ссылка на товар/услугу/серию/модификацию, которую представляет собой позиция, в формате [Метаданных](/api/remap/1.2/doc/index.html#header-метаданные)
+ **pack** - Упаковка товара

С позициями можно работать с помощью специальных ресурсов для управления позициями Счёта,
а также в составе отдельного Счёта покупателю. При работе в составе отдельного Счёта покупателю,
вы можете отправлять запросы на создание отдельного Счёта покупателю с включенным в тело запроса
массивом позиций Счёта. Если количество позиций превышает максимально допустимое, то для
дальнейшего пополнения позиций нужно будет работать со специальным ресурсом "Позиции Счёта покупателю".
Также, при работе в составе отдельного Счёта покупателю, можно отправлять запросы на обновление списка позиций
с включенным в тело запроса массивом позиций Счёта. При этом важно помнить, что коллекция позиций будет
восприниматься как "все позиции Счёта" и полностью заменит уже существующую коллекцию при обновлении объекта - лишние
позиции будут удалены, новые добавлены, существующие - изменены.

<!-- include(rate.apib) -->

О работе с доп. полями Счетов покупателям можно прочитать [здесь](/api/remap/1.2/doc/index.html#header-работа-с-дополнительными-полями)


### Получить Счета покупателям [GET]
Запрос всех Счетов покупателям на данной учётной записи.
Результат: Объект JSON, включающий в себя поля:
- **meta** [Метаданные](/api/remap/1.2/doc/index.html#header-метаданные) о выдаче,
- **context** - [Метаданные](/api/remap/1.2/doc/index.html#header-метаданные) о сотруднике, выполнившем запрос.
- **rows** - Массив JSON объектов, представляющих собой Счета покупателям.
+ Parameters
  + limit: 1000 (optional, enum[number])
  Максимальное количество сущностей для извлечения.
  <p>
    <code>Допустимые значения 1 - 1000</code>
  </p>
      + Default: `1000`
  + offset: 40 (optional, number)
    Отступ в выдаваемом списке сущностей
      + Default: `0`

  + search: `0001` (optional, string)
    URL Параметр для поиска по имени документа.
    Фильтр документов по указанной поисковой строке. Фильтрация происходит по
    полю name.

+ Response 200 (application/json)
Успешный запрос. Результат - JSON представление списка Счетов покупателям.
  + Body
        <!-- include(body/invoice_out/get_list.json) -->

### Создать Счёт покупателю [POST]
Запрос на создание нового Счёта покупателю.
Обязательные для создания поля:
+ **name** - номер Счёта покупателю
+ **organization** - Ссылка на ваше юрлицо в формате [Метаданных](/api/remap/1.2/doc/index.html#header-метаданные)
+ **agent** - Ссылка на контрагента (покупателя) в формате [Метаданных](/api/remap/1.2/doc/index.html#header-метаданные)
+ Request Пример (application/json)
Пример создания нового Счёта с телом запроса, содержащим только необходимые поля.
  + Body
        <!-- include(body/invoice_out/post_short_request.json) -->

+ Response 200 (application/json)
Успешный запрос. Результат - JSON представление созданного Счёта покупателю.
  + Body
        <!-- include(body/invoice_out/post_short_response.json) -->

+ Request Пример 2 (application/json)
Пример создания нового Счёта с более насыщенным телом запроса.
  + Body
        <!-- include(body/invoice_out/post_long_request.json) -->

+ Response 200 (application/json)
Успешный запрос. Результат - JSON представление созданного Счёта покупателю.
  + Body
        <!-- include(body/invoice_out/post_long_response.json) -->

+ Request Пример с доп. полями (application/json)
Пример запроса на создание Счёта покупателю с доп. полями.
  + Body
        <!-- include(body/invoice_out/post_with_attributes_request.json) -->

+ Response 200 (application/json)
Успешный запрос. Результат - JSON представление созданного Счёта покупателю.
  + Body
        <!-- include(body/invoice_out/post_with_attributes_response.json) -->

+ Request Пример с позициями (application/json)
Пример запроса на создание Счёта покупателю с позициями в теле запроса.
  + Body
        <!-- include(body/invoice_out/post_with_positions_request.json) -->

+ Response 200 (application/json)
Успешный запрос. Результат - JSON представление созданного Счёта покупателю.
  + Body
        <!-- include(body/invoice_out/post_with_positions_response.json) -->

### Массовое создание и обновление Счётов покупателю [POST]
[Массовое создание и обновление](/api/remap/1.2/doc/index.html#header-создание-и-обновление-нескольких-объектов) Счётов покупателю.
В теле запроса нужно передать массив, содержащий JSON представления Счётов покупателю, которые вы хотите создать или обновить.
Обновляемые Счёта покупателю должны содержать идентификатор в виде метаданных.

+ Request Пример (application/json)
Пример создания и обновления нескольких Счётов покупателю
  + Body
        <!-- include(body/invoice_out/post_massive_request.json) -->

+ Response 200 (application/json)
Успешный запрос. Результат - массив JSON представлений созданных и обновленных Счётов покупателю.
  + Body
        <!-- include(body/invoice_out/post_massive_response.json) -->

### Удалить Счёт покупателю [DELETE /entity/invoiceout/{id}]
+ Parameters
  + id: `7944ef04-f831-11e5-7a69-971500188b19` (required, string) - id Счёта покупателю

Запрос на удаление Счёта покупателю с указанным id.

+ Response 200 (application/json)
Успешное удаление Счёта покупателю.

## Метаданные Счетов покупателям [/entity/invoiceout/metadata]
### Метаданные Счетов покупателям [GET]
Запрос на получение метаданных Счетов покупателям. Результат - объект JSON, включающий в себя:
+ **meta** - Ссылка на метаданные Счетов покупателям
+ **attributes** - Массив объектов доп. полей Счетов покупателям в формате [Метаданных](/api/remap/1.2/doc/index.html#header-метаданные)
+ **states** - Массив статусов Счетов покупателям
+ **createShared** - создавать новые Счета покупателям с меткой "Общий"

Структура отдельного объекта, представляющего доп. поле подробно описана в разделе [Работа с дополнительными полями](/api/remap/1.2/doc/index.html#header-работа-с-дополнительными-полями).

+ Response 200 (application/json)
Успешный запрос. Результат - JSON представление доп. полей Счетов покупателям.
  + Body
        <!-- include(body/invoice_out/metadata.json) -->

## Отдельное доп. поле [/entity/invoiceout/metadata/attributes/{id}]
+ Parameters
  + id: `7944ef04-f831-11e5-7a69-971500188b19` (required, string) - id Доп. поля
### Отдельное доп. поле [GET]
Запрос на получение информации по отдельному дополнительному полю.
+ Response 200 (application/json)
Успешный запрос. Результат - JSON представление отдельного доп. поля.
  + Body
        <!-- include(body/invoice_out/metadata_by_id.json) -->

## Шаблон счёта покупателю [/entity/invoiceout/new]
### Шаблон счёта покупателю [PUT]
Запрос на получение предзаполненого стандартными значениями шаблона счёта покупателю без связи с каким-либо документом.

+ Request Пустое тело запроса (application/json)
+ Response 200 (application/json)
Успешный запрос. Результат - JSON представление предзаполненного счёта покупателю.
  + Body
        <!-- include(body/invoice_out/new_empty.json) -->
### Шаблон счёта покупателю на основе [PUT]
Запрос на получение предзаполненного счёта покупателю на основе заказа покупателя или отгрузки.
В результате запроса, будет создан предзаполненный шаблон счёта покупателю на основе переданного
документа.
+ Request заказ покупателя (application/json)
Запрос на создание счёта покупателю на основе заказа покупателя.
  + Body
        <!-- include(body/invoice_out/new_order_request.json) -->
+ Response 200 (application/json)
Успешный запрос. Результат - JSON представление предзаполненного счёта покупателю.
  + Body
        <!-- include(body/invoice_out/new_order_response.json) -->

+ Request отгрузка (application/json)
Запрос на создание счёта покупателю на основе отгрузки.
  + Body
        <!-- include(body/invoice_out/new_demand_request.json) -->
+ Response 200 (application/json)
Успешный запрос. Результат - JSON представление предзаполненного счёта покупателю.
  + Body
        <!-- include(body/invoice_out/new_demand_response.json) -->


## Счёт покупателю [/entity/invoiceout/{id}]
+ Parameters
  + id: `7944ef04-f831-11e5-7a69-971500188b19` (required, string) - id Счёта покупателю
### Получить Счёт покупателю [GET]
Запрос на получение отдельного Счёта покупателю с указанным id.
+ Response 200 (application/json)
Успешный запрос. Результат - JSON представление Счёта покупателю.
  + Body
        <!-- include(body/invoice_out/get_by_id.json) -->

### Изменить Счёт покупателю [PUT]
Запрос на обновление Счета покупателю с указанным id.
В теле запроса можно указать только те поля, которые необходимо изменить у Счёта покупателю, кроме тех, что
помечены `Только для чтения` в описании [атрибутов Счёта покупателю](#документ-счёт-покупателю-счета-покупателям).
При обновлении полей **organization** и **agent** нужно также обновить поля **organizationAccount** и
**agentAccount** соответственно, иначе произойдёт ошибка.

+ Request Пример (application/json)
Пример запроса на обновление отдельного Счёта покупателю.
  + Body
        <!-- include(body/invoice_out/put_request.json) -->

+ Response 200 (application/json)
Успешный запрос. Результат - JSON представление обновлённого Счёта покупателю.
  + Body
        <!-- include(body/invoice_out/put_response.json) -->

+ Request Пример с доп. полями (application/json)
Пример запроса на изменение Счёта покупателю с дополнительными полями.
  + Body
        <!-- include(body/invoice_out/put_with_attributes_request.json) -->

+ Response 200 (application/json)
Успешный запрос. Результат - JSON представление обновлённого Счёта покупателю.
  + Body
       <!-- include(body/invoice_out/put_with_attributes_response.json) -->

+ Request Пример с позициями (application/json)
Пример запроса на обновление Счёта покупателю с позициями в теле запроса.
  + Body
        <!-- include(body/invoice_out/put_with_positions_request.json) -->

+ Response 200 (application/json)
Успешный запрос. Результат - JSON представление обновлённого Счёта покупателю.
  + Body
        <!-- include(body/invoice_out/put_with_positions_response.json) -->

## Позиции Счёта покупателю [/entity/invoiceout/{id}/positions]
Отдельный ресурс для управления позициями Счёта покупателю. С его помощью вы можете управлять позициями большого документа, количество строк в котором превышает лимит на количество строк, сохраняемых вместе с документом. Этот лимит равен 100. Более подробно о лимитах на количество строк документа и работе с большими документами можно прочитать [тут](/api/remap/1.2/doc/index.html#header-работа-с-позициями-документов).
+ Parameters
  + id: `7944ef04-f831-11e5-7a69-971500188b19` (required, string) - id Счёта покупателю
### Получить позиции Счёта покупателю [GET]
Запрос на получение списка всех позиций данного Счёта покупателю.
- **meta** [Метаданные](/api/remap/1.2/doc/index.html#header-метаданные) о выдаче,
- **context** - [Метаданные](/api/remap/1.2/doc/index.html#header-метаданные) о сотруднике, выполнившем запрос.
- **rows** - Массив JSON объектов, представляющих собой позиции Счёта покупателю.

+ Parameters
  + limit: 1000 (optional, enum[number])
  Максимальное количество сущностей для извлечения.
  <p>
    <code>Допустимые значения 1 - 1000</code>
  </p>
      + Default: `1000`
  + offset: 40 (optional, number)
    Отступ в выдаваемом списке сущностей
      + Default: `0`

+ Response 200 (application/json)
Успешный запрос. Результат - JSON представление списка позиций отдельного Счёта покупателю.
  + Body
        <!-- include(body/invoice_out/get_positions_list.json) -->
### Добавить позицию в Счёт покупателя [POST]
Запрос на создание новой позиции в Счёте покупателю.
Для успешного создания необходимо в теле запроса указать следующие поля:
+ **assortment** - Ссылка на товар/услугу/серию/модификацию, которую представляет собой позиция.
Также можно указать поле с именем **service**, **consignment**, **variant** в соответствии с тем,
чем является указанная позиция. Подробнее об этом поле можно прочитать в описании [позиции Счёта](#header-позиции-счёта-покупателю)
+ **quantity** - Количество указанной позиции. Должно быть положительным, иначе возникнет ошибка.
Также, как и при работе с [Позициями Заказа Покупателя](/api/remap/1.2/doc/customerOrder.html#документ-заказ-покупателя-позиции-заказа-покупателя), можно создать как одну, так и несколько позиций в одном запросе.

+ Request Пример (application/json)
Пример создания позиции в Счёте покупателю.
  + Body
      <!-- include(body/invoice_out/post_position_request.json) -->

+ Response 200 (application/json)
Успешный запрос. Результат - JSON представление созданной позиции отдельного Счёте покупателю.
  + Body
        <!-- include(body/invoice_out/post_position_response.json) -->


## Позиция Счёта покупателя [/entity/invoiceout/{id}/positions/{positionID}]
Отдельная позиция Счёта покупателю с указанным id позиции.
+ Parameters
  + id: `7944ef04-f831-11e5-7a69-971500188b19` (required, string) - id Счёта покупателю
  + positionID: `34f6344f-015e-11e6-9464-e4de0000006c` (required, string) - id позиции Счёта покупателю
### Получить позицию Счёта [GET]
Запрос на получение отдельной позиции Счёта с указанным id.
+ Response 200 (application/json)
Успешный запрос. Результат - JSON представление отдельной позиции Счёта покупателю.
  + Body
        <!-- include(body/invoice_out/get_position_by_id.json) -->
### Изменить позицию Счёта [PUT]
Запрос на обновление отдельной позиции Счёта. Для обновления позиции нет каких-либо
 обязательных для указания в теле запроса полей. Только те, что вы желаете обновить.
+ Request Пример (application/json)
Пример запроса на обновление отдельной позиции в Счёте покупателю.
  + Body
      <!-- include(body/invoice_out/put_position_request.json) -->

+ Response 200 (application/json)
Успешный запрос. Результат - JSON представление обновлённой позиции Счёта покупателю.
  + Body
        <!-- include(body/invoice_out/put_position_response.json) -->

### Удалить позицию [DELETE]
Запрос на удаление отдельной позиции Счёта с указанным id.

+ Response 200 (application/json)
Успешное удаление позиции Счёта.
