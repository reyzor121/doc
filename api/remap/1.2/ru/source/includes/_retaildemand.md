<!-- include(metadata.apib) -->

* Документ Розничная продажа
Средствами JSON API можно создавать и обновлять сведения о Розничных продажах, запрашивать списки Розничных продаж и сведения по отдельным Розничным продажам. Позициями Розничных продаж можно управлять как в составе отдельной Розничной продажи, так и отдельно - с помощью специальных ресурсов для управления позициями Розничными продажами. Кодом сущности для Розничной продажи в составе JSON API является ключевое слово **retaildemand**. Больше о Розничных продажах и работе с ними в основном интерфейсе вы можете прочитать в нашей службе поддержки по  [этой ссылке](https://support.moysklad.ru/hc/ru/articles/203325423-%D0%A0%D0%BE%D0%B7%D0%BD%D0%B8%D1%86%D0%B0) в разделе Оформление продажи.
** Розничные продажи [/entity/retaildemand]
*** Атрибуты сущности
+ **meta** - [Метаданные](/api/remap/1.2/doc/index.html#header-метаданные) о Розничной продаже
+ **id** - ID в формате UUID `Только для чтения`
+ **accountId** - ID учетной записи `Только для чтения`
+ **syncId** - ID синхронизации. После заполнения недоступен для изменения.
+ **updated** - Момент последнего обновления сущности `Только для чтения`
+ **deleted** - Момент последнего удаления сущности `Только для чтения`
+ **name** - номер Розничной продажи
+ **description** - Комментарий Розничной продажи
+ **externalCode** - Внешний код Розничной продажи
+ **moment** - Дата Розничной продажи
+ **applicable** - Отметка о проведении
+ **vatEnabled** - Учитывается ли НДС
+ **vatIncluded** - Включен ли НДС в цену
+ **sum** - Сумма Розничной продажи в копейках `Только для чтения`
+ **rate** - Валюта
+ **owner** - Ссылка на Владельца (Сотрудника) в формате [Метаданных](/api/remap/1.2/doc/index.html#header-метаданные)
+ **shared** - Общий доступ
+ **group** - Отдел сотрудника в формате [Метаданных](/api/remap/1.2/doc/index.html#header-метаданные)
+ **organization** - Ссылка на ваше юрлицо в формате [Метаданных](/api/remap/1.2/doc/index.html#header-метаданные)
+ **agent** - Ссылка на контрагента в формате [Метаданных](/api/remap/1.2/doc/index.html#header-метаданные)
+ **store** - Ссылка на склад в формате [Метаданных](/api/remap/1.2/doc/index.html#header-метаданные)
+ **contract** - Ссылка на договор в формате [Метаданных](/api/remap/1.2/doc/index.html#header-метаданные)
+ **project** - Ссылка на проект в формате [Метаданных](/api/remap/1.2/doc/index.html#header-метаданные)
+ **state** - Статус Розничной продажи в формате [Метаданных](/api/remap/1.2/doc/index.html#header-метаданные)
+ **organizationAccount** - Ссылка на счёт вашего юрлица в формате [Метаданных](/api/remap/1.2/doc/index.html#header-метаданные)
+ **agentAccount** - Ссылка на счёт контрагента в формате [Метаданных](/api/remap/1.2/doc/index.html#header-метаданные)
+ **attributes** - Коллекция доп. полей в формате [Метаданных](/api/remap/1.2/doc/index.html#header-метаданные)
+ **documents** - Список печатных форм в формате [Метаданных](/api/remap/1.2/doc/index.html#header-метаданные)
<br>Поля при expand'е:</br>
  - **name** - номер документа
  - **moment** - дата печати
  - **href** - ссылка на файл печатной формы
  - **fileName** - название файла печатной формы
  - **updated** - дата последнего изменения
+ **created** - Дата создания `Только для чтения`
+ **vatSum** - Сумма НДС `Только для чтения`
+ **positions** - Ссылка на позиции Розничной продажи в формате [Метаданных](/api/remap/1.2/doc/index.html#header-метаданные)
+ **fiscalPrinterInfo** - Информация о фискальном регистраторе
+ **documentNumber** - Номер документа
+ **checkNumber** - Номер чека
+ **checkSum** - Сумма Чека
+ **fiscal** - Отметка о том, был ли использован ФР `Только для чтения`
+ **sessionNumber** - Номер сессии
+ **ofdCode** -Код оператора фискальных данных
+ **payedSum** - Сумма входящих платежей по Розничной продаже `Только для чтения`
+ **retailStore** - Ссылка на точку продаж в формате [Метаданных](/api/remap/1.2/doc/index.html#header-метаданные)
+ **customerOrder** - Ссылка на Заказ Покупателя, с которым связана эта Розничная продажа в формате [Метаданных](/api/remap/1.2/doc/index.html#header-метаданные)
+ **retailShift** - Ссылка на Розничную смену, в рамках которой была проведена продажа в формате [Метаданных](/api/remap/1.2/doc/index.html#header-метаданные) `Необходимое`
+ **cashSum**  - Оплачено наличными
+ **noCashSum** - Оплачено картой

*** Позиции Розничной продажи
Позиции Розничной продажи - это список товаров/услуг/модификаций/серий.
Объект позиции Розничной продажи содержит следующие поля:
+ **id** - ID товара в формате UUID `Только для чтения`
+ **accountId** - ID учетной записи `Только для чтения`
+ **quantity** - Количество товаров/услуг данного вида в позиции. Если позиция - товар, у которого включен учёт по серийным номерам, то значение в этом поле всегда будет равно количеству серийных номеров для данной позиции в документе.
+ **price** - Цена товара/услуги в копейках
+ **discount** - Процент скидки или наценки. Наценка указывается отрицательным числом, т.е. -10 создаст наценку в 10%
+ **vat** - НДС, которым облагается текущая позиция
+ **assortment** - Ссылка на товар/услугу/серию/модификацию, которую представляет собой позиция, в формате [Метаданных](/api/remap/1.2/doc/index.html#header-метаданные)
+ **pack** - Упаковка товара
+ **things** - Серийные номера
Значение данного атрибута игнорируется, если товар позиции не находится на серийном учете.
В ином случае количество товаров в позиции будет равно количеству серийных номеров, переданных в значении атрибута.
+ **cost** - Себестоимость (только для услуг)

С позициями можно работать с помощью специальных [ресурсов для управления позициями Розничной продажи](#документ-розничная-продажа-позиции-розничной-продажи),
а также в составе отдельной Розничной продажи. При работе в составе отдельной Розничной продажи,
вы можете отправлять запросы на создание отдельной Розничной продажи с включенным в тело запроса
массивом позиций Розничной продажи. Если количество позиций превышает максимально допустимое, то для
дальнейшего пополнения позиций нужно будет работать со специальным ресурсом "Позиции Розничной продажи".
Также, при работе в составе отдельной Розничной продажи, можно отправлять запросы на обновление списка позиций
с включенным в тело запроса массивом позиций Розничной продажи. При этом важно помнить, что коллекция позиций будет
восприниматься как "все позиции Розничной продажи" и полностью заменит уже существующую коллекцию при обновлении объекта - лишние
позиции будут удалены, новые добавлены, существующие - изменены.

<!-- include(rate.apib) -->

О работе с доп. полями Розничных продаж можно прочитать [здесь](/api/remap/1.2/doc/index.html#header-работа-с-дополнительными-полями)


*** Получить Розничные продажи [GET]
Запрос всех Розничных продаж на данной учётной записи.
Результат: Объект JSON, включающий в себя поля:
- **meta** [Метаданные](/api/remap/1.2/doc/index.html#header-метаданные) о выдаче,
- **context** - [Метаданные](/api/remap/1.2/doc/index.html#header-метаданные) о сотруднике, выполнившем запрос.
- **rows** - Массив JSON объектов, представляющих собой Розничные продажи.
+ Parameters
  + limit: 1000 (optional, enum[number])
  Максимальное количество сущностей для извлечения.
  <p>
    <code>Допустимые значения 1 - 1000</code>
  </p>
      + Default: `1000`
  + offset: 40 (optional, number)
    Отступ в выдаваемом списке сущностей
      + Default: `0`

+ Response 200 (application/json)
Успешный запрос. Результат - JSON представление списка Розничных продаж.
  + Body
        <!-- include(body/retaildemand/get_list.json) -->


*** Создать Розничную продажу [POST]
Розничная смена, на которую указывает ссылка при создании Розничной продажи обязательно должна быть активной.
При создании Розничной продажи через JSON API, дата, указанная в **moment** продажи
должна быть позже даты, указанной в **moment** активной розничной смены, иначе
произойдёт ошибка. Также, если вы указываете поля **cashSum** и **noCashSum** их сумма должна совпадать с суммой по Розничной продаже
(т.е. с суммарной стоимостью всех переданных вами позиций).
Обязательные поля при создании новой Розничной продажи:
+ **name** - Номер продажи
+ **retailShift** - Сссылка на Розничную смену, в рамках которой происходит продажа

+ Request Пример 1 (application/json)
Пример создания новой Розничной продажи с телом запроса, содержащим только необходимые поля.
  + Body
        <!-- include(body/retaildemand/post_short_request.json) -->

+ Response 200 (application/json)
Успешный запрос. Результат - JSON представление созданной Розничной продажи.
  + Body
        <!-- include(body/retaildemand/post_short_response.json) -->

+ Request Пример 2 (application/json)
Пример создания новой Розничной продажи с более насыщенным телом запроса.
  + Body
        <!-- include(body/retaildemand/post_long_request.json) -->

+ Response 200 (application/json)
Успешный запрос. Результат - JSON представление созданной Розничной продажи.
  + Body
        <!-- include(body/retaildemand/post_long_response.json) -->

+ Request Пример с позициями (application/json)
Пример запроса на создание Розничной продажи с позициями в теле запроса.
  + Body
        <!-- include(body/retaildemand/post_with_positions_request.json) -->

+ Response 200 (application/json)
Успешный запрос. Результат - JSON представление созданной Розничной продажи.
  + Body
        <!-- include(body/retaildemand/post_with_positions_response.json) -->
+ Request Пример с доп полями (application/json)
Пример запроса на создание Розничной продажи с доп. полями.
  + Body
        <!-- include(body/retaildemand/post_with_attributes_request.json) -->

+ Response 200 (application/json)
Успешный запрос. Результат - JSON представление созданной Розничной продажи.
  + Body
        <!-- include(body/retaildemand/post_with_attributes_response.json) -->

*** Массовое создание и обновление Розничных продаж [POST]
[Массовое создание и обновление](/api/remap/1.2/doc/index.html#header-создание-и-обновление-нескольких-объектов) Розничных продаж.
В теле запроса нужно передать массив, содержащий JSON представления Розничных продаж, которые вы хотите создать или обновить.
Обновляемые Розничные продажи должны содержать идентификатор в виде метаданных.

+ Request Пример (application/json)
Пример создания и обновления нескольких Розничных продаж
  + Body
        <!-- include(body/retaildemand/post_massive_request.json) -->

+ Response 200 (application/json)
Успешный запрос. Результат - массив JSON представлений созданных и обновленных Розничных продаж.
  + Body
        <!-- include(body/retaildemand/post_massive_response.json) -->

*** Удалить Розничную продажу [DELETE /entity/retaildemand/{id}]
+ Parameters
  + id: `7944ef04-f831-11e5-7a69-971500188b19` (required, string) - id Розничной продажи

Запрос на удаление Розничной продажи с указанным id.

+ Response 200 (application/json)
Успешное удаление Розничной продажи.

** Метаданные Розничных продаж [/entity/retaildemand/metadata]
*** Метаданные Розничных продаж [GET]
Запрос на получение метаданных Розничных продаж. Результат - объект JSON, включающий в себя:
+ **meta** - Ссылка на метаданные Розничных продаж
+ **attributes** - Массив объектов доп. полей Розничных продаж в формате [Метаданных](/api/remap/1.2/doc/index.html#header-метаданные)
+ **states** - Массив статусов Розничных продаж
+ **createShared** - создавать новые Розничные продажи с меткой "Общий"

Структура отдельного объекта, представляющего доп. поле подробно описана в разделе [Работа с дополнительными полями](/api/remap/1.2/doc/index.html#header-работа-с-дополнительными-полями).

+ Response 200 (application/json)
Успешный запрос. Результат - JSON представление доп. полей Розничных продаж.
  + Body
        <!-- include(body/retaildemand/get_metadata.json) -->

** Отдельное доп. поле [/entity/retaildemand/metadata/attributes/{id}]
+ Parameters
  + id: `7944ef04-f831-11e5-7a69-971500188b19` (required, string) - id Доп. поля
*** Отдельное доп. поле [GET]
Запрос на получение информации по отдельному дополнительному полю.
+ Response 200 (application/json)
Успешный запрос. Результат - JSON представление отдельного доп. поля.
  + Body
        <!-- include(body/retaildemand/metadata_by_id.json) -->

** Шаблон розничной продажи [/entity/retaildemand/new]
*** Шаблон розничной продажи [PUT]
Запрос на получение предзаполненого стандартными значениями шаблона розничной продажи на основе других документов.
При получении шаблона розничной продажи, всегда обязательно указывать ссылку на розничную смену. Без связи со сменой, получить шаблон продажи нельзя.
Шаблон продажи можно получить на основе:
+ Розничной смены
+ Заказа покупателя

+ Request Пример со сменой (application/json)
Пример получения шаблона розничной продажи с телом запроса, содержащим информацию о розничной смене.
  + Body
        <!-- include(body/retaildemand/post_short_request.json) -->
+ Response 200 (application/json)
Успешный запрос. Результат - JSON представление предзаполненной розничной продажи.
  + Body
        <!-- include(body/retaildemand/new_empty.json) -->

+ Request Пример с заказом (application/json)
Пример получения шаблона розничной продажи с телом запроса, содержащим информацию о розничной смене и заказе покупателя.
  + Body
        <!-- include(body/retaildemand/put_new_by_customerorder.json) -->
+ Response 200 (application/json)
Успешный запрос. Результат - JSON представление предзаполненной розничной продажи.
  + Body
        <!-- include(body/retaildemand/new_by_customerorder.json) -->

** Розничная продажа [/entity/retaildemand/{id}]
+ Parameters
  + id: `7944ef04-f831-11e5-7a69-971500188b19` (required, string) - id Розничной продажи

*** Получить Розничную продажу [GET]
Запрос на получение отдельной Розничной продажи с указанным id.
+ Response 200 (application/json)
Успешный запрос. Результат - JSON представление Розничной продажи с указанным id.
  + Body
        <!-- include(body/retaildemand/get_by_id.json) -->

*** Изменить Розничную продажу [PUT]
Запрос на обновление Розничной продажи с указанным id.
В теле запроса можно указать только те поля, которые необходимо изменить у Розничной продажи, кроме тех, что
помечены `Только для чтения` в описании [атрибутов Розничной продажи](#документ-розничная-продажа-розничные-продажи).
При обновлении полей **organization** и **agent** нужно также обновить поля **organizationAccount** и
**agentAccount** соответственно, иначе произойдёт ошибка.
Также, если вы изменяете поля **cashSum** и **noCashSum** их сумма должна совпадать с суммой по Розничной продаже (т.е. с суммарной стоимостью всех позиций).

+ Request Пример 1 (application/json)
Пример запроса на обновление Розничной продажи.
  + Body
        <!-- include(body/retaildemand/put_request.json) -->

+ Response 200 (application/json)
Успешный запрос. Результат - JSON представление обновлённой Розничной продажи.
  + Body
        <!-- include(body/retaildemand/put_response.json) -->


+ Request Пример 2 (application/json)
Пример запроса на обновление Розничной продажи с доп. полями и позициями в теле запроса.
  + Body
        <!-- include(body/retaildemand/put_with_collections_request.json) -->
+ Response 200 (application/json)
Успешный запрос. Результат - JSON представление обновлённой Розничной продажи.
  + Body
        <!-- include(body/retaildemand/put_with_collections_response.json) -->

** Позиции Розничной продажи [/entity/retaildemand/{id}/positions]
Отдельный ресурс для управления позициями Розничной продажи. С его помощью вы можете управлять позициями большого документа, количество строк в котором превышает лимит на количество строк, сохраняемых вместе с документом. Этот лимит равен 100. Более подробно о лимитах на количество строк документа и работе с большими документами можно прочитать [тут](/api/remap/1.2/doc/index.html#header-работа-с-позициями-документов).
+ Parameters
  + id: `7944ef04-f831-11e5-7a69-971500188b19` (required, string) - id Розничной продажи
*** Получить Позиции [GET]
Запрос на получение списка всех позиций данной Розничной продажи.
- **meta** [Метаданные](/api/remap/1.2/doc/index.html#header-метаданные) о выдаче,
- **context** - [Метаданные](/api/remap/1.2/doc/index.html#header-метаданные) о сотруднике, выполнившем запрос.
- **rows** - Массив JSON объектов, представляющих собой позиции Розничной продажи.
+ Parameters
  + limit: 1000 (optional, enum[number])
  Максимальное количество сущностей для извлечения.
  <p>
    <code>Допустимые значения 1 - 1000</code>
  </p>
      + Default: `1000`
  + offset: 40 (optional, number)
    Отступ в выдаваемом списке сущностей
      + Default: `0`

+ Response 200 (application/json)
Успешный запрос. Результат - JSON представление списка позиций Розничной продажи.
  + Body
        <!-- include(body/retaildemand/positions_get_list.json) -->


*** Создать Позицию [POST]
Запрос на создание новой позиции в Розничной продаже.
Для успешного создания необходимо в теле запроса указать следующие поля:
+ **assortment** - Ссылка на товар/услугу/серию/модификацию, которую представляет собой позиция.
Также можно указать поле с именем **service**, **consignment**, **variant** в соответствии с тем,
чем является указанная позиция. Подробнее об этом поле можно прочитать в описании [позиции Розничной продажи](#header-позиции-розничной-продажи).
+ **quantity** - Количество указанной позиции. Должно быть положительным, иначе возникнет ошибка.
Одновременно можно создать как одну так и несколько позиций Розничной продажи. Все созданные данным запросом позиции
будут добавлены к уже существующим.
+ Request Пример (application/json)
Пример запроса на создание позиций в Розничной продаже.
  + Body
        <!-- include(body/retaildemand/positions_post_request.json) -->
+ Response 200 (application/json)
Успешный запрос. Результат - JSON представление созданных позиций.
  + Body
        <!-- include(body/retaildemand/positions_post_response.json) -->

** Позиция Розничной продажи [/entity/retaildemand/{id}/positions/{positionID}]
+ Parameters
  + id: `7944ef04-f831-11e5-7a69-971500188b19` (required, string) - id Розничной продажи
  + positionID: `34f6344f-015e-11e6-9464-e4de0000006c` (required, string) - id позиции Розничной продажи
*** Получить Позицию [GET]
Запрос на получение отдельной позиции Розничной продажи с указанным id.
+ Response 200 (application/json)
Успешный запрос. Результат - JSON представление отдельной позиции Розничной продажи.
  + Body
        <!-- include(body/retaildemand/positions_get_by_id.json) -->
*** Изменить Позицию [PUT]
Запрос на обновление отдельной позиции Розничной продажи.
+ Request Пример (application/json)
Пример запроса на обновление отдельной позиции в Розничной продаже.
  + Body
        <!-- include(body/retaildemand/positions_put_request.json) -->

+ Response 200 (application/json)
Успешный запрос. Результат - JSON представление обновлённой позиции Розничной продажи.
  + Body
        <!-- include(body/retaildemand/positions_put_response.json) -->

*** Удалить позицию [DELETE]
Запрос на удаление отдельной позиции Розничной продажи с указанным id.

+ Response 200 (application/json)
Успешное удаление позиции Розничной продажи.
