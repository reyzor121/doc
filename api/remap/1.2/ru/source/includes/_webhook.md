<!-- include(metadata.apib) -->

# Веб-хуки
На платных аккаунтах с помощью средств JSON API вы можете: получать, создавать, обновлять, отключать и удалять веб-хуки. Управление веб-хуками доступно **только администратору аккаунта**.
Ключевым словом для веб-хуков в рамках JSON api является **webhook**.
## Веб-хуки [/entity/webhook]
Пример того, в каком виде будут передаваться данные:
<pre>
{
 "events":
  [
   {"meta":
     {
       "type":"product",
       "href":"https://online.moysklad.ru/api/remap/1.2/entity/product/c1557cfb-c2cc-11e6-7a31-d0fd000f0b00"
     },
    "action":"DELETE"
   }
  ]
}
</pre>
В массиве **events** может быть несколько объектов.
В ответ на наш запрос мы ожидаем получить ответ с HTTP статусом 200 или 204.
С помощью API версии 1.2 можно просматривать, изменять, удалять веб-хуки созданные только с помощью API версии 1.2.

## Заголовок временного отключения через API
Через JSON API или POS API при запросах можно отключить уведомления вебхуков в контексте данного запроса. Для этого нужно указать заголовок `X-Lognex-WebHook-Disable` с произвольным значением.

## Атрибуты сущности
+ **meta** - [Метаданные](/api/remap/1.2/doc/index.html#header-метаданные) веб-хука
+ **id** - id веб-хука
+ **accountId** - id учётной записи
+ **entityType** - тип сущности, к которой привязан веб-хук `Необходимое`
+ **url** - URL, по которому будет происходить запрос `Необходимое`
+ **method** - HTTP метод, с которым будет происходить запрос <br>
Возможные значения: `POST`
+ **enabled** - Флажок состояние веб-хука (включен / отключен) <br>
+ **action** - Действие, которое отслеживается веб-хуком `Необходимое` <br>
Возможные значения:  `[CREATE, UPDATE, DELETE]`


### Получить список веб-хуков [GET]
Запрос на получение всех веб-хуков на данной учётной записи.

+ Response 200 (application/json)
Успешный запрос. Результат - JSON представление списка веб-хуков.
  + Body
        <!-- include(body/webhook/get_list.json) -->

### Создать веб-хук [POST]
Пример запроса на создание нового веб-хука. Убедитесь, что создаетё ещё не существующий веб-хук:
сочетание **entityType**, **action** должно быть уникальным.

+ Request Пример (application/json)
Пример запроса на создание нового веб-хука.
  + Body
        <!-- include(body/webhook/post_request.json) -->

+ Response 200 (application/json)
Успешный запрос. Результат - JSON представление созданного веб-хука.
  + Body
        <!-- include(body/webhook/post_response.json) -->

## Веб-хук [/entity/webhook/{id}]

+ Parameters
  + id: `7944ef04-f831-11e5-7a69-971500188b19` (required, string) - id веб-хука

### Массовое создание и обновление веб-хуков [POST]
[Массовое создание и обновление](/api/remap/1.2/doc/index.html#header-создание-и-обновление-нескольких-объектов) веб-хуков.
В теле запроса нужно передать массив, содержащий JSON представления веб-хуков, которые вы хотите создать или обновить.
Обновляемые веб-хуки должны содержать идентификатор в виде метаданных.

+ Request Пример (application/json)
Пример создания и обновления нескольких веб-хуков
  + Body
        <!-- include(body/webhook/post_massive_request.json) -->

+ Response 200 (application/json)
Успешный запрос. Результат - массив JSON представлений созданных и обновленных веб-хуков.
  + Body
        <!-- include(body/webhook/post_massive_response.json) -->

### Получить отдельный веб-хук [GET]
Запрос на получение отдельного веб-хука с указанным id.
+ Response 200 (application/json)
Успешный запрос. Результат - JSON представление веб-хука с указанным id.
  + Body
        <!-- include(body/webhook/get_by_id.json) -->
### Обновить веб-хук [PUT]
Пример запроса на обновление сведений о веб-хуке.

+ Request Пример (application/json)
Пример запроса на обновление веб-хука.
  + Body
        <!-- include(body/webhook/put_request.json) -->

+ Response 200 (application/json)
Успешный запрос. Результат - JSON представление обновлённого веб-хука.
  + Body
        <!-- include(body/webhook/put_response.json) -->

### Отключить веб-хук [PUT]
Пример запроса на отключение веб-хука.

+ Request Пример (application/json)
Пример запроса на отключение веб-хука.
  + Body
        <!-- include(body/webhook/disable_request.json) -->

+ Response 200 (application/json)
Успешный запрос. Результат - JSON представление отключенного веб-хука.
  + Body
        <!-- include(body/webhook/disable_response.json) -->

### Удалить веб-хук [DELETE]
Пример запроса на удаление веб-хука с указанным id.

+ Parameters
  + id: `7944ef04-f831-11e5-7a69-971500188b19` (required, string) - id веб-хука

+ Response 200 (application/json)
Успешное удаление веб-хука.
